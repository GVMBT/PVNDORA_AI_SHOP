# –ú–æ–¥–µ–ª—å "–ü–æ–¥ –ó–∞–∫–∞–∑" (On-Demand Orders)

## –ë–∏–∑–Ω–µ—Å-–ú–æ–¥–µ–ª—å

**–ü—Ä–∏–Ω—Ü–∏–ø:** –†–∞–±–æ—Ç–∞ —Å "—Å–∫–æ—Ä–æ–ø–æ—Ä—Ç—è—â–∏–º—Å—è" —Ç–æ–≤–∞—Ä–æ–º (–ø–æ–¥–ø–∏—Å–∫–∏ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º —Å—Ä–æ–∫–æ–º –¥–µ–π—Å—Ç–≤–∏—è).

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:**

- –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä –µ—Å—Ç—å –≤ –Ω–∞–ª–∏—á–∏–∏ ‚Üí –≤—ã–¥–∞—á–∞ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã (Instant Fulfillment)
- –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä–∞ –Ω–µ—Ç ‚Üí –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ ‚Üí –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ/–ø–æ–ª—É—á–µ–Ω–∏–µ ‚Üí –≤—ã–¥–∞—á–∞ (Prepaid Order)
- –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ instant (–≤ –Ω–∞–ª–∏—á–∏–∏) + prepaid (–ø–æ–¥ –∑–∞–∫–∞–∑)
- –í —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –°—Ç–∞—Ç—É—Å—ã –¢–æ–≤–∞—Ä–∞ (products.status)

| –°—Ç–∞—Ç—É—Å | –ù–∞–ª–∏—á–∏–µ | –î–µ–π—Å—Ç–≤–∏–µ |
|--------|---------|----------|
| **active** | stock > 0 | –ê–≤—Ç–æ–≤—ã–¥–∞—á–∞ (instant order) |
| **active** | stock = 0 | –ü—Ä–µ–¥–∑–∞–∫–∞–∑ (prepaid order) |
| **out_of_stock** | stock > 0 | –ê–≤—Ç–æ–≤—ã–¥–∞—á–∞ (instant order) |
| **out_of_stock** | stock = 0 | –ü—Ä–µ–¥–∑–∞–∫–∞–∑ (prepaid order) |
| **discontinued** | –ª—é–±–æ–π | –ó–∞–∫–∞–∑ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, waitlist –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (—Ç–æ–≤–∞—Ä–∞ –±–æ–ª—å—à–µ –Ω–µ—Ç) |
| **coming_soon** | –ª—é–±–æ–π | –ó–∞–∫–∞–∑ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Ç–æ–ª—å–∫–æ waitlist (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏) |

## –°—Ç–∞—Ç—É—Å—ã –ó–∞–∫–∞–∑–æ–≤

- **pending** - –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω, –æ–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã
- **prepaid** - –ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∞, —Ç–æ–≤–∞—Ä –∏–∑–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
- **fulfilling** - –¢–æ–≤–∞—Ä –≥–æ—Ç–æ–≤–∏—Ç—Å—è/–ø–æ–ª—É—á–∞–µ—Ç—Å—è –æ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
- **ready** - –¢–æ–≤–∞—Ä –≥–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ
- **delivered** - –¢–æ–≤–∞—Ä –≤—ã–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- **cancelled** - –ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω–µ–Ω (–¥–æ –æ–ø–ª–∞—Ç—ã)
- **refunded** - –ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω–µ–Ω, –¥–µ–Ω—å–≥–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã
- **failed** - –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä, –≤–æ–∑–≤—Ä–∞—Ç –æ—Ñ–æ—Ä–º–ª–µ–Ω

## –ü–æ—Ç–æ–∫–∏ –û–±—Ä–∞–±–æ—Ç–∫–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –¢–æ–≤–∞—Ä –≤ –Ω–∞–ª–∏—á–∏–∏ (Instant Fulfillment)

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ç–æ–≤–∞—Ä
2. AI –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —á–µ—Ä–µ–∑ Function Calling
3. –¢–æ–≤–∞—Ä –Ω–∞–π–¥–µ–Ω ‚Üí –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–∫–∞–∑ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "pending" (order_type='instant')
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç
5. Webhook –ø–ª–∞—Ç–µ–∂–∞ ‚Üí –°—Ç–∞—Ç—É—Å "delivered"
6. QStash Worker –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –¢–æ–≤–∞—Ä–∞ –Ω–µ—Ç (Prepaid + Fulfillment)

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ç–æ–≤–∞—Ä
2. AI –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ ‚Üí –¢–æ–≤–∞—Ä–∞ –Ω–µ—Ç
3. AI –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç: "–¢–æ–≤–∞—Ä–∞ –Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏. –ú–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å –ø–æ–¥ –∑–∞–∫–∞–∑ –∑–∞ 2-3 –¥–Ω—è. –ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ 100%"
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–≥–ª–∞—à–∞–µ—Ç—Å—è
5. –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–∫–∞–∑ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "pending" (order_type='prepaid')
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç ‚Üí –°—Ç–∞—Ç—É—Å "prepaid"
7. QStash Worker —É–≤–µ–¥–æ–º–ª—è–µ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è
8. –ü–æ—Å—Ç–∞–≤—â–∏–∫ –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–≤–∞—Ä ‚Üí –û–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–∫–∞–∑: —Å—Ç–∞—Ç—É—Å "fulfilling" ‚Üí "ready"
9. QStash Worker –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä ‚Üí –°—Ç–∞—Ç—É—Å "delivered"

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º —Ç–æ–≤–∞—Ä–∞ (Refund)

1. –ó–∞–∫–∞–∑ –≤ —Å—Ç–∞—Ç—É—Å–µ "prepaid" –∏–ª–∏ "fulfilling"
2. –ü—Ä–æ—à–ª–æ –±–æ–ª—å—à–µ –¥–µ–¥–ª–∞–π–Ω–∞ (—Ç–∞–π–º–∞—É—Ç) ‚Üí –°—Ç–∞—Ç—É—Å "failed"
3. QStash Worker: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤
4. –°—Ç–∞—Ç—É—Å "refunded", –¥–µ–Ω—å–≥–∏ –Ω–∞ –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
5. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –≤–æ–∑–≤—Ä–∞—Ç–µ

## –ó–∞–≥—Ä—É–∑–∫–∞ –¢–æ–≤–∞—Ä–∞ –ü–æ—Å—Ç–∞–≤—â–∏–∫–æ–º

### –ü—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –≤ —Å–∏—Å—Ç–µ–º—É

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞ (–¥–ª—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤)

1. –ü–æ—Å—Ç–∞–≤—â–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –±–æ—Ç—É –∫–æ–º–∞–Ω–¥—É `/add_stock` –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ "–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä"
2. –ë–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç:
   - ID —Ç–æ–≤–∞—Ä–∞ (product_id) –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ
   - –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–æ–≤–∞—Ä–∞ (Login:Pass, Cookie, –∏–Ω–≤–∞–π—Ç-—Å—Å—ã–ª–∫–∞)
   - –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (expires_at) - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
3. –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ `stock_items`:
   - `product_id` - —Å–≤—è–∑—å —Å —Ç–æ–≤–∞—Ä–æ–º
   - `content` - –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—ã–¥–∞—á–∏
   - `expires_at` - —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)
   - `is_sold = false` - —Ç–æ–≤–∞—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏
   - `created_at` - –¥–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (–¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å–∫–∏–¥–∫–∏)
4. –¢–æ–≤–∞—Ä —Å—Ä–∞–∑—É —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º –¥–ª—è –ø–æ–∫—É–ø–∫–∏

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ API (–¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏)

1. –ü–æ—Å—Ç–∞–≤—â–∏–∫ –≤—ã–∑—ã–≤–∞–µ—Ç `POST /api/supplier/add-stock`
2. –ü–µ—Ä–µ–¥–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Ç–æ–≤–∞—Ä–æ–≤ (batch upload)
3. –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π –≤ `stock_items` –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π
4. –í—Å–µ —Ç–æ–≤–∞—Ä—ã —Å—Ä–∞–∑—É –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏

#### –í–∞—Ä–∏–∞–Ω—Ç 3: –î–ª—è –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤

1. –ü–æ—Å—Ç–∞–≤—â–∏–∫ –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–Ω–æ–º –∑–∞–∫–∞–∑–µ —á–µ—Ä–µ–∑ QStash Worker
2. –ü–æ—Å—Ç–∞–≤—â–∏–∫ –∏–∑–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç/–ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–≤–∞—Ä
3. –ü–æ—Å—Ç–∞–≤—â–∏–∫ –≤—ã–∑—ã–≤–∞–µ—Ç `POST /api/supplier/fulfill-order` —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞
4. –°–∏—Å—Ç–µ–º–∞:
   - –°–æ–∑–¥–∞–µ—Ç `stock_item` —Å `is_sold=true` (—Å—Ä–∞–∑—É –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∑–∞–∫–∞–∑—É)
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–∫–∞–∑: —Å—Ç–∞—Ç—É—Å "ready"
   - QStash Worker –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è

- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç View `available_stock_with_discounts`
- AI Function Calling —Å—Ä–∞–∑—É –≤–∏–¥–∏—Ç –Ω–æ–≤–æ–µ –Ω–∞–ª–∏—á–∏–µ
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å–∫–∏–¥–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ `created_at`

## –ü–æ–∫—É–ø–∫–∞ –ù–µ—Å–∫–æ–ª—å–∫–∏—Ö –ï–¥–∏–Ω–∏—Ü –¢–æ–≤–∞—Ä–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π: –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å, –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä–æ–≤

**–ü—Ä–∏–º–µ—Ä:** "–ù—É–∂–Ω–æ 3 –∞–∫–∫–∞—É–Ω—Ç–∞ ChatGPT Plus, 5 Gemini Pro –∏ 2 Canva Pro"

**–ü—Ä–æ—Ü–µ—Å—Å:**

1. **AI –ø–∞—Ä—Å–∏—Ç –∑–∞–ø—Ä–æ—Å:**
   - –†–∞—Å–ø–æ–∑–Ω–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤
   - –í—ã–∑—ã–≤–∞–µ—Ç `check_product_availability` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ (—Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–∞–∫–∂–µ `can_fulfill_on_demand` –∏ `fulfillment_time_hours`)
   - –§–æ—Ä–º–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫: `[{product_id: "...", quantity: 3}, {product_id: "...", quantity: 5}, ...]`

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:**
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ —á–µ—Ä–µ–∑ Function Calling
   - **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:** –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–¥–µ–ª—è–µ—Ç –Ω–∞ instant (–≤ –Ω–∞–ª–∏—á–∏–∏) + prepaid (–ø–æ–¥ –∑–∞–∫–∞–∑)
   - –ü—Ä–∏–º–µ—Ä: "–ù—É–∂–Ω–æ 2 Gemini, –≤ –Ω–∞–ª–∏—á–∏–∏ —Ç–æ–ª—å–∫–æ 1" ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è: 1 instant + 1 prepaid
   - AI —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç: "ChatGPT Plus: 3 —à—Ç. –≤ –Ω–∞–ª–∏—á–∏–∏, Gemini Pro: 1 –≤ –Ω–∞–ª–∏—á–∏–∏ + 1 –ø–æ–¥ –∑–∞–∫–∞–∑ (2-3 –¥–Ω—è), Canva Pro: 2 –≤ –Ω–∞–ª–∏—á–∏–∏"

3. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤:**
   - –î–ª—è —Ç–æ–≤–∞—Ä–æ–≤ –≤ –Ω–∞–ª–∏—á–∏–∏: —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ–¥–∏–Ω –∑–∞–∫–∞–∑ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏ (–∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–∫–∞–∑–æ–≤)
   - –î–ª—è —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ–¥ –∑–∞–∫–∞–∑: —Å–æ–∑–¥–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–Ω—ã–µ –∑–∞–∫–∞–∑—ã
   - –í—Å–µ –∑–∞–∫–∞–∑—ã –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –≤ –æ–¥–Ω—É –∫–æ—Ä–∑–∏–Ω—É (cart)

4. **–û–ø–ª–∞—Ç–∞:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –æ–±—â—É—é —Å—É–º–º—É –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤
   - –û–ø–ª–∞—á–∏–≤–∞–µ—Ç –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π
   - –°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–ø–ª–∞—Ç—É –ø–æ –∑–∞–∫–∞–∑–∞–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

5. **–í—ã–¥–∞—á–∞:**
   - –¢–æ–≤–∞—Ä—ã –≤ –Ω–∞–ª–∏—á–∏–∏ ‚Üí –≤—ã–¥–∞—é—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã (–æ–¥–∏–Ω QStash Worker –¥–ª—è –≤—Å–µ—Ö)
   - –¢–æ–≤–∞—Ä—ã –ø–æ–¥ –∑–∞–∫–∞–∑ ‚Üí –≤—ã–¥–∞—é—Ç—Å—è –ø–æ –º–µ—Ä–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (–æ—Ç–¥–µ–ª—å–Ω—ã–µ QStash Workers)

### –°—Ü–µ–Ω–∞—Ä–∏–π: –†–∞–∑–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä:** 
- –°–æ–æ–±—â–µ–Ω–∏–µ 1: "–•–æ—á—É 3 GPT"
- –°–æ–æ–±—â–µ–Ω–∏–µ 2: "–ò –µ—â–µ 5 Gemini"
- –°–æ–æ–±—â–µ–Ω–∏–µ 3: "–ò 2 Canva"

**–ü—Ä–æ—Ü–µ—Å—Å:**

1. **–ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:**
   - AI —Å–æ–∑–¥–∞–µ—Ç –∫–æ—Ä–∑–∏–Ω—É –≤ Redis: `cart:{user_id}` = `[{product_id: "gpt", quantity: 3}]`
   - –ó–∞–∫–∞–∑—ã –≤ –ë–î –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω—ã (—Ç–æ–ª—å–∫–æ –∫–æ—Ä–∑–∏–Ω–∞)
   - AI –æ—Ç–≤–µ—á–∞–µ—Ç: "–î–æ–±–∞–≤–∏–ª 3 ChatGPT Plus –≤ –∫–æ—Ä–∑–∏–Ω—É. –ò—Ç–æ–≥–æ: 3 —à—Ç. –Ω–∞ 900‚ÇΩ. –î–æ–±–∞–≤–∏—Ç—å –µ—â–µ —á—Ç–æ-—Ç–æ –∏–ª–∏ –æ–ø–ª–∞—Ç–∏—Ç—å?"

2. **–í—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:**
   - AI –ø–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â—É—é –∫–æ—Ä–∑–∏–Ω—É –∏–∑ Redis —á–µ—Ä–µ–∑ Function Calling
   - –î–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä: `cart:{user_id}` = `[{gpt: 3}, {gemini: 5}]`
   - AI –æ—Ç–≤–µ—á–∞–µ—Ç: "–î–æ–±–∞–≤–∏–ª 5 Gemini Pro. –í –∫–æ—Ä–∑–∏–Ω–µ: 3 GPT (900‚ÇΩ) + 5 Gemini (1500‚ÇΩ) = 2400‚ÇΩ. –û–ø–ª–∞—Ç–∏—Ç—å?"

3. **–¢—Ä–µ—Ç—å–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:**
   - –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –≤—Ç–æ—Ä–æ–º—É
   - –í—Å–µ —Ç–æ–≤–∞—Ä—ã –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ –æ–¥–Ω—É –∫–æ—Ä–∑–∏–Ω—É –≤ Redis

4. **–û–ø–ª–∞—Ç–∞:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–û–ø–ª–∞—Ç–∏—Ç—å"
   - Backend —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑—ã –≤ –ë–î –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã Redis
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π
   - –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –∫–æ—Ä–∑–∏–Ω–∞ —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ Redis

### –°—Ü–µ–Ω–∞—Ä–∏–π: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏ –æ—Ç–º–µ–Ω–∞ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ

**–ü—Ä–∏–º–µ—Ä:**
- –°–æ–æ–±—â–µ–Ω–∏–µ 1: "–•–æ—á—É 5 Gemini"
- –°–æ–æ–±—â–µ–Ω–∏–µ 2: "–•–æ—á—É –µ—â–µ 3 GPT"
- –°–æ–æ–±—â–µ–Ω–∏–µ 3: "–ù–µ—Ç, –¥–∞–≤–∞–π—Ç–µ –ø—Ä–æ—Å—Ç–æ 2 Gemini"

**–ü—Ä–æ—Ü–µ—Å—Å:**

1. **–°–æ–æ–±—â–µ–Ω–∏–µ 1: "–•–æ—á—É 5 Gemini"**
   - AI –≤—ã–∑—ã–≤–∞–µ—Ç `add_to_cart` —á–µ—Ä–µ–∑ Function Calling
   - Backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ: –≤ –Ω–∞–ª–∏—á–∏–∏ —Ç–æ–ª—å–∫–æ 1
   - Backend –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–¥–µ–ª—è–µ—Ç: `[{gemini: 1, type: 'instant'}, {gemini: 1, type: 'prepaid'}]` (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ 2, –Ω–æ –≤ –Ω–∞–ª–∏—á–∏–∏ 1)
   - –ö–æ—Ä–∑–∏–Ω–∞ –≤ Redis: `cart:{user_id}` = `[{product_id: "gemini", quantity: 5, items: [{qty: 1, type: 'instant'}, {qty: 4, type: 'prepaid'}]}]`
   - AI –æ—Ç–≤–µ—á–∞–µ—Ç: "–î–æ–±–∞–≤–∏–ª 5 Gemini Pro: 1 –≤ –Ω–∞–ª–∏—á–∏–∏ (300‚ÇΩ) + 4 –ø–æ–¥ –∑–∞–∫–∞–∑ –∑–∞ 2-3 –¥–Ω—è (1200‚ÇΩ). –ò—Ç–æ–≥–æ: 1500‚ÇΩ"

2. **–°–æ–æ–±—â–µ–Ω–∏–µ 2: "–•–æ—á—É –µ—â–µ 3 GPT"**
   - AI –ø–æ–ª—É—á–∞–µ—Ç –∫–æ—Ä–∑–∏–Ω—É —á–µ—Ä–µ–∑ `get_user_cart`
   - AI –≤—ã–∑—ã–≤–∞–µ—Ç `add_to_cart` –¥–ª—è GPT
   - –ö–æ—Ä–∑–∏–Ω–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è: –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è GPT

3. **–°–æ–æ–±—â–µ–Ω–∏–µ 3: "–ù–µ—Ç, –¥–∞–≤–∞–π—Ç–µ –ø—Ä–æ—Å—Ç–æ 2 Gemini"**
   - AI —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
     - "–ù–µ—Ç" = –æ—Ç–º–µ–Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (GPT)
     - "–ø—Ä–æ—Å—Ç–æ 2 Gemini" = –Ω–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è Gemini
   - AI –≤—ã–∑—ã–≤–∞–µ—Ç `update_cart` —á–µ—Ä–µ–∑ Function Calling
   - Backend –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ—Ä–∑–∏–Ω—É –≤ Redis:
     - –£–¥–∞–ª—è–µ—Ç GPT
     - –ò–∑–º–µ–Ω—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ Gemini: 5 ‚Üí 2 (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç instant + prepaid)
   - –ò—Ç–æ–≥–æ–≤–∞—è –∫–æ—Ä–∑–∏–Ω–∞: `[{gemini: 2, items: [{qty: 1, type: 'instant'}, {qty: 1, type: 'prepaid'}]}]`
   - AI –æ—Ç–≤–µ—á–∞–µ—Ç: "–ò—Å–ø—Ä–∞–≤–∏–ª! –í –∫–æ—Ä–∑–∏–Ω–µ: 2 Gemini Pro (1 –≤ –Ω–∞–ª–∏—á–∏–∏ + 1 –ø–æ–¥ –∑–∞–∫–∞–∑) –Ω–∞ 600‚ÇΩ. –û–ø–ª–∞—Ç–∏—Ç—å?"

**–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–π –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- "–ù–µ—Ç" / "–û—Ç–º–µ–Ω–∞" / "–ù–µ –Ω–∞–¥–æ" ‚Üí —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
- "–¢–æ–ª—å–∫–æ X" / "–ü—Ä–æ—Å—Ç–æ X" ‚Üí –æ—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ X
- "–í–º–µ—Å—Ç–æ X –¥–∞–≤–∞–π Y" ‚Üí –∑–∞–º–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞
- "–£–±–µ—Ä–∏ X" ‚Üí —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
- "–ò–∑–º–µ–Ω–∏ –Ω–∞ N" ‚Üí –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫:**

- **Cart (–ö–æ—Ä–∑–∏–Ω–∞):** –í—Ä–µ–º–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤ Redis, —Ö—Ä–∞–Ω–∏—Ç —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –¥–æ –æ–ø–ª–∞—Ç—ã
  - –ö–ª—é—á: `cart:{user_telegram_id}`
  - TTL: 24 —á–∞—Å–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –∫–æ—Ä–∑–∏–Ω)
  - –§–æ—Ä–º–∞—Ç: JSON —Å –º–∞—Å—Å–∏–≤–æ–º items, –∫–∞–∂–¥—ã–π item –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å instant + prepaid —á–∞—Å—Ç–∏
- **Order Group:** –ì—Ä—É–ø–ø–∞ –∑–∞–∫–∞–∑–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π –æ–ø–ª–∞—Ç—ã (—Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ checkout)
- **Batch Delivery:** QStash Worker –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–∫–∞–∑–æ–≤ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–µ–π

**–í–∞–∂–Ω–æ:** –ó–∞–∫–∞–∑—ã –≤ –ë–î —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ checkout (–Ω–∞–∂–∞—Ç–∏–µ "–û–ø–ª–∞—Ç–∏—Ç—å"), –¥–æ —ç—Ç–æ–≥–æ –≤—Å–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Redis –∫–æ—Ä–∑–∏–Ω–µ.

**AI Structured Output –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫:**

```json
{
  "thought": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç 3 GPT, 5 Gemini, 2 Canva",
  "reply_text": "–û—Ç–ª–∏—á–Ω–æ! –£ –º–µ–Ω—è –µ—Å—Ç—å –≤—Å–µ —ç—Ç–∏ —Ç–æ–≤–∞—Ä—ã...",
  "action": "offer_payment",
  "items": [
    {"product_id": "...", "quantity": 3, "available": 3, "price": 900},
    {"product_id": "...", "quantity": 5, "available": 2, "prepaid": 3, "price": 1500},
    {"product_id": "...", "quantity": 2, "available": 2, "price": 600}
  ],
  "total_amount": 3000
}
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ backend:**

1. **–î–æ –æ–ø–ª–∞—Ç—ã (–∫–æ—Ä–∑–∏–Ω–∞ –≤ Redis):**
   - AI –≤—ã–∑—ã–≤–∞–µ—Ç `add_to_cart` —á–µ—Ä–µ–∑ Function Calling
   - Backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≤ –ë–î (Supabase) —á–µ—Ä–µ–∑ `check_product_availability`
   - **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:** –ï—Å–ª–∏ `available < quantity`, backend –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç:
     - `instant_quantity = min(available, quantity)` - —Ç–æ–≤–∞—Ä—ã –≤ –Ω–∞–ª–∏—á–∏–∏
     - `prepaid_quantity = max(0, quantity - available)` - —Ç–æ–≤–∞—Ä—ã –ø–æ–¥ –∑–∞–∫–∞–∑
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ Redis: `cart:{user_id}` = `{items: [{product_id, quantity, instant_quantity, prepaid_quantity, price}]}`
   - AI –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –∫–æ—Ä–∑–∏–Ω—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–æ–∑—Ä–∞—á–Ω—É—é —Ä–∞–∑–±–∏–≤–∫—É

2. **–ü—Ä–∏ checkout (—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –≤ –ë–î):**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–û–ø–ª–∞—Ç–∏—Ç—å"
   - Backend —á–∏—Ç–∞–µ—Ç –∫–æ—Ä–∑–∏–Ω—É –∏–∑ Redis
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ item —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑—ã —á–µ—Ä–µ–∑ `create_order_with_availability_check`:
     - –ï—Å–ª–∏ `instant_quantity > 0`: —Å–æ–∑–¥–∞–µ—Ç instant –∑–∞–∫–∞–∑(—ã) —á–µ—Ä–µ–∑ `reserve_product_for_purchase`
     - –ï—Å–ª–∏ `prepaid_quantity > 0`: —Å–æ–∑–¥–∞–µ—Ç prepaid –∑–∞–∫–∞–∑(—ã) —Å `fulfillment_deadline`
   - –í—Å–µ –∑–∞–∫–∞–∑—ã —Å–≤—è–∑—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `order_group_id` (–Ω–æ–≤–æ–µ –ø–æ–ª–µ –≤ —Ç–∞–±–ª–∏—Ü–µ orders)
   - –ö–æ—Ä–∑–∏–Ω–∞ —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ Redis

3. **–ü—Ä–∏ –æ–ø–ª–∞—Ç–µ:**
   - –û–¥–∏–Ω –ø–ª–∞—Ç–µ–∂ ‚Üí –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–∫–∞–∑–æ–≤ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
   - Instant –∑–∞–∫–∞–∑—ã ‚Üí —Å—Ä–∞–∑—É "delivered", QStash Worker –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —á–µ—Ä–µ–∑ `/api/workers/deliver-goods`
   - Prepaid –∑–∞–∫–∞–∑—ã ‚Üí —Å—Ç–∞—Ç—É—Å "prepaid", QStash Worker —É–≤–µ–¥–æ–º–ª—è–µ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ —á–µ—Ä–µ–∑ `/api/workers/notify-supplier-prepaid`

4. **–ü—Ä–∏ –≤—ã–¥–∞—á–µ:**
   - QStash Worker –ø–æ–ª—É—á–∞–µ—Ç `order_group_id` –∏ –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤—Å–µ –≥–æ—Ç–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã –æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ `/api/workers/deliver-batch`

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –°—Ö–µ–º—ã –ë–î

### –¢–∞–±–ª–∏—Ü–∞ orders

–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è:
- `order_type` - 'instant' –∏–ª–∏ 'prepaid'
- `fulfillment_deadline` - –¥–µ–¥–ª–∞–π–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–¥–ª—è –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã)
- `refund_reason` - –ø—Ä–∏—á–∏–Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞
- `refund_processed_at` - –¥–∞—Ç–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞
- `supplier_notified_at` - –¥–∞—Ç–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
- `order_group_id` - UUID –≥—Ä—É–ø–ø—ã –∑–∞–∫–∞–∑–æ–≤ (–¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫)

### –¢–∞–±–ª–∏—Ü–∞ products

–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è:

- `fulfillment_time_hours` - –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 48 —á–∞—Å–æ–≤)
- `requires_prepayment` - —Ç—Ä–µ–±—É–µ—Ç—Å—è –ª–∏ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞
- `prepayment_percent` - –ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã (0-100)

## QStash Workers

### 1. POST /api/workers/notify-supplier-prepaid

–£–≤–µ–¥–æ–º–ª—è–µ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞.

### 2. POST /api/workers/check-fulfillment-timeout

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–∫–∞–∑—ã –Ω–∞ —Ç–∞–π–º–∞—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (Cron job, –∫–∞–∂–¥—ã–π —á–∞—Å). –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ñ–æ—Ä–º–ª—è–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç –¥–ª—è –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤.

### 3. POST /api/workers/process-refund

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤: –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –∑–∞–∫–∞–∑ –≤ —Å—Ç–∞—Ç—É—Å "refunded" –∏ –Ω–∞—á–∏—Å–ª—è–µ—Ç –¥–µ–Ω—å–≥–∏ –Ω–∞ –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### 4. POST /api/workers/deliver-batch

–î–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä–æ–≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–æ–π (–¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫). –ü–æ–ª—É—á–∞–µ—Ç `order_group_id` –∏ –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞

1. **–¢–∞–π–º–∞—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** –ó–∞–∫–∞–∑ –ø—Ä–µ–≤—ã—Å–∏–ª `fulfillment_deadline` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–æ–∑–≤—Ä–∞—Ç
2. **–ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
3. **–ü—Ä–æ–±–ª–µ–º–∞ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞:** –ü–æ—Å—Ç–∞–≤—â–∏–∫ —Å–æ–æ–±—â–∞–µ—Ç –æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–∫–∞–∑ ‚Üí —Ä—É—á–Ω–æ–π –ø–µ—Ä–µ–≤–æ–¥ –≤ "failed" ‚Üí –≤–æ–∑–≤—Ä–∞—Ç

## –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞

"‚úÖ –ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω! –¢–æ–≤–∞—Ä: ChatGPT Plus. –°—É–º–º–∞: 300‚ÇΩ (–ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ 100%). –°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 2-3 –¥–Ω—è. –ú—ã —É–≤–µ–¥–æ–º–∏–º –≤–∞—Å, –∫–æ–≥–¥–∞ —Ç–æ–≤–∞—Ä –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤."

### –ü—Ä–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–∞

"üéâ –í–∞—à –∑–∞–∫–∞–∑ –≥–æ—Ç–æ–≤! ChatGPT Plus –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω: –õ–æ–≥–∏–Ω: user@example.com, –ü–∞—Ä–æ–ª—å: ********. –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: –¥–æ 15.12.2025"

### –ü—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –ø–æ–∫—É–ø–∫–µ

"‚úÖ –í–∞—à –∑–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω! ChatGPT Plus x3, Gemini Pro x5, Canva Pro x2. –û–±—â–∞—è —Å—É–º–º–∞: 3000‚ÇΩ. –û–ø–ª–∞—Ç–∏—Ç–µ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã —Å—Ä–∞–∑—É."

### –ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã

"‚úÖ –ò—Å–ø—Ä–∞–≤–∏–ª –∫–æ—Ä–∑–∏–Ω—É! –í –∫–æ—Ä–∑–∏–Ω–µ: 2 Gemini Pro (1 –≤ –Ω–∞–ª–∏—á–∏–∏ + 1 –ø–æ–¥ –∑–∞–∫–∞–∑) –Ω–∞ 600‚ÇΩ. –û–ø–ª–∞—Ç–∏—Ç—å?"

### –ü—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ

"‚ö†Ô∏è –ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω–µ–Ω. –ü—Ä–∏—á–∏–Ω–∞: {refund_reason}. –°—É–º–º–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞: 300‚ÇΩ. –°—Ç–∞—Ç—É—Å: –ó–∞—á–∏—Å–ª–µ–Ω–æ –Ω–∞ –≤–∞—à –±–∞–ª–∞–Ω—Å. –í–∞—à –±–∞–ª–∞–Ω—Å: 300‚ÇΩ"

## –ò—Ç–æ–≥–æ–≤–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **–î–≤–∞ —Ç–∏–ø–∞ –∑–∞–∫–∞–∑–æ–≤:** instant (—Ç–æ–≤–∞—Ä –≤ –Ω–∞–ª–∏—á–∏–∏) –∏ prepaid (–ø–æ–¥ –∑–∞–∫–∞–∑)
2. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã:** 8 —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞
3. **–°–∏—Å—Ç–µ–º–∞ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏ –ø–æ –∑–∞–ø—Ä–æ—Å—É
4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤:** –ß–µ—Ä–µ–∑ QStash –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏
5. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–∫—É–ø–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –µ–¥–∏–Ω–∏—Ü —Ä–∞–∑–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –æ–¥–Ω–∏–º –∏–ª–∏ —Ä–∞–∑–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
6. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω–æ–π:** –ö–æ—Ä–∑–∏–Ω–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Redis –¥–æ –æ–ø–ª–∞—Ç—ã, –∑–∞–∫–∞–∑—ã –≤ –ë–î —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ checkout
7. **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —É–¥–∞–ª—è—Ç—å —Ç–æ–≤–∞—Ä—ã, –æ—Ç–º–µ–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã –¥–æ –æ–ø–ª–∞—Ç—ã
8. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:** –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –Ω–∞–ª–∏—á–∏–∏ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–¥–µ–ª—è–µ—Ç –Ω–∞ instant + prepaid
9. **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∑–∞–∫–∞–∑–æ–≤:** –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –≤ –≥—Ä—É–ø–ø—ã –¥–ª—è —É–¥–æ–±–Ω–æ–π –æ–ø–ª–∞—Ç—ã –∏ –≤—ã–¥–∞—á–∏

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å: —Ä–∞–±–æ—Ç–∞ —Å —Ç–æ–≤–∞—Ä–æ–º –ª—é–±–æ–≥–æ —Ç–∏–ø–∞ (–≤ –Ω–∞–ª–∏—á–∏–∏ –∏–ª–∏ –ø–æ–¥ –∑–∞–∫–∞–∑)
- ‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–∑–≤—Ä–∞—Ç—ã –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
- ‚úÖ –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–Ω–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è: –º–∏–Ω–∏–º—É–º —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫ –∏ batch-–æ–±—Ä–∞–±–æ—Ç–∫–∏
