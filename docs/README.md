# Техническая Документация PVNDORA

## Обзор

Эта папка содержит детальную техническую документацию для реализации проекта PVNDORA AI Marketplace.

## Структура Документации

### 1. [Архитектура Асинхронных Процессов](./async-architecture.md)
Описание гибридной асинхронной архитектуры:
- Best-Effort обработка (BackgroundTasks)
- Guaranteed Delivery (QStash)
- Конфигурация и примеры использования

### 2. [Стратегия AI и Спецификация Моделей](./ai-strategy.md)
Детальная архитектура AI-ядра:
- RAG (Retrieval Augmented Generation)
- Function Calling для точности
- Structured Outputs для детерминизма
- Pydantic модели и примеры

### 3. [Схема Базы Данных](./database-schema.md)
ERD и модель данных:
- Структура таблиц и связей
- SQL View для оптимизации
- Хранимые процедуры (RPC)
- Векторная коллекция (vecs)

### 4. [Спецификация API](./api-specification.md)
Контракт взаимодействия:
- Эндпоинты для Mini App
- Эндпоинты для QStash Workers
- Вебхуки (Telegram, платежные системы)
- OpenAPI схема

### 5. [Диаграммы Последовательности](./sequence-diagrams.md)
Визуализация ключевых процессов:
- Процесс покупки
- AI-консультация
- Резервирование и оплата
- Обработка ошибок

### 6. [CI/CD Пайплайн](./cicd-pipeline.md)
Автоматизация разработки:
- GitHub Actions workflow
- Quality Gates
- Управление секретами
- Стратегия развертывания

### 7. [UX, Deep Linking и Локализация](./ux-deep-linking.md)
Спецификация пользовательского опыта:
- Разделение ответственности: Чат vs Mini App
- Бесшовный Deep Linking (Base64url)
- RTL поддержка
- Культурная адаптация
- Виральность через switchInlineQuery
- Human Handoff процесс

### 8. [Валюты и Локализация Цен](./CURRENCY_LOCALIZATION.md)
Стратегия работы с валютами:
- Основная валюта: USD ($)
- Конвертация по курсу для всех языков
- Маппинг язык → валюта
- Форматирование цен
- Интеграция с платежными системами

### 9. [Модель "Под Заказ"](./ON_DEMAND_ORDERS.md)
Бизнес-модель работы с товаром "скоропортом":
- Instant Fulfillment (товар в наличии)
- Prepaid Orders (товар под заказ)
- Автоматическое разделение на instant + prepaid при недостаточном наличии
- Управление корзиной через Redis (до оплаты)
- Редактирование корзины (изменение количества, удаление товаров)
- Система возвратов
- Уведомления поставщиков
- Таймауты и автоматические возвраты

## Удаленные Функции

Следующие функции были исключены из MVP:
- **Визуальный поиск** - сложность пайплайна (скачивание файла с Telegram, загрузка в Google)
- **Обработка голосовых сообщений** - аналогичная сложность пайплайна

## Связанные Документы

- [Brief.md](../Brief.md) - Функциональные требования
- [ARCHITECTURE.md](../ARCHITECTURE.md) - Правила архитектуры

## Быстрый Старт

1. Изучите [Brief.md](../Brief.md) для понимания бизнес-требований
2. Ознакомьтесь с [ARCHITECTURE.md](../ARCHITECTURE.md) для архитектурных правил
3. Изучите техническую документацию в этой папке для деталей реализации

## Порядок Реализации

1. **Настройка инфраструктуры:**
   - Supabase (БД + миграции)
   - Upstash (QStash + Redis)
   - Vercel (деплой)

2. **База данных:**
   - Применение миграций
   - Создание SQL View
   - Настройка хранимых процедур

3. **Backend:**
   - FastAPI приложение
   - Интеграция с QStash
   - AI-консультант с Structured Outputs

4. **Frontend:**
   - Mini App (React)
   - Интеграция с Telegram WebApp API

5. **CI/CD:**
   - Настройка GitHub Actions
   - Автоматизация деплоя

