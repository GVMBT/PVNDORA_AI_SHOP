# PVNDORA ‚Äî Production Readiness Test Plan

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2026-01-09  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–¶–µ–ª—å:** –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–∏—Å—Ç–µ–º –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è](#–æ–±—â–∞—è-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
2. [–¢–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã](#—Ç–µ—Å—Ç–æ–≤—ã–µ-–∞–∫–∫–∞—É–Ω—Ç—ã)
3. [–¢–µ—Å—Ç-–∫–µ–π—Å—ã –ø–æ –º–æ–¥—É–ª—è–º](#—Ç–µ—Å—Ç-–∫–µ–π—Å—ã-–ø–æ-–º–æ–¥—É–ª—è–º)
4. [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏](#–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-—Å—Ü–µ–Ω–∞—Ä–∏–∏)
5. [–ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏](#—á–µ–∫–ª–∏—Å—Ç-–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏)

---

## –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | URL/–¢–æ–∫–µ–Ω | –°—Ç–∞—Ç—É—Å |
|-----------|-----------|--------|
| **Production URL** | `https://pvndora.app` | ‚úÖ |
| **Vercel Deployment** | –ü–æ—Å–ª–µ–¥–Ω–∏–π deployment | ‚úÖ |
| **Supabase** | Production DB | ‚ö†Ô∏è |
| **QStash** | Production | ‚ö†Ô∏è |
| **Upstash Redis** | Production | ‚ö†Ô∏è |

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã —Ç—Ä–µ–±—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–µ–Ω–µ–≥! –ò—Å–ø–æ–ª—å–∑—É–π —Ç–µ—Å—Ç–æ–≤—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –∏–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Å—É–º–º—ã.

---

## –¢–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ä–æ–ª–∏

1. **–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** (–±–µ–∑ –ø–æ–∫—É–ø–æ–∫, –±–µ–∑ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤)
2. **–ê–∫—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** (1-2 –ø–æ–∫—É–ø–∫–∏, –µ—Å—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—ã)
3. **VIP –ø–∞—Ä—Ç–Ω—ë—Ä** (–º–Ω–æ–≥–æ –ø–æ–∫—É–ø–æ–∫, –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã)
4. **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä** (–¥–æ—Å—Ç—É–ø –∫ Admin Bot + Admin Panel)

### –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

```yaml
test_users:
  new_user:
    telegram_id: <—Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π>
    expected: –ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤, –±–∞–ª–∞–Ω—Å 0, —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞
  
  active_user:
    telegram_id: <—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å –ø–æ–∫—É–ø–∫–∞–º–∏>
    expected: –ï—Å—Ç—å –∑–∞–∫–∞–∑—ã, –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞, –º–æ–∂–µ—Ç –±—ã—Ç—å –±–∞–ª–∞–Ω—Å
  
  vip_partner:
    telegram_id: <–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –ø–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–æ–º>
    expected: VIP —Å—Ç–∞—Ç—É—Å, –≤—ã—Å–æ–∫–∏–µ –∫–æ–º–∏—Å—Å–∏–∏
  
  admin:
    telegram_id: <–∏–∑ ADMIN_TELEGRAM_IDS>
    expected: –î–æ—Å—Ç—É–ø –∫ Admin Bot, Admin Panel
```

---

## –¢–µ—Å—Ç-–∫–µ–π—Å—ã –ø–æ –º–æ–¥—É–ª—è–º

---

## 1. üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### 1.1 Telegram Mini App Auth

**User Flow:**
```
1. –û—Ç–∫—Ä—ã—Ç—å Mini App —á–µ—Ä–µ–∑ –±–æ—Ç–∞
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (initData –≤–∞–ª–∏–¥–∞—Ü–∏—è)
3. –°–æ–∑–¥–∞—Ç—å/–ø–æ–ª—É—á–∏—Ç—å —Å–µ—Å—Å–∏—é
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] Mini App –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- [ ] `X-Init-Data` header –≤–∞–ª–∏–¥–Ω—ã–π
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ –ë–î –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ
- [ ] –Ø–∑—ã–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (ru/en/de/etc)
- [ ] –í–∞–ª—é—Ç–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ —è–∑—ã–∫—É (ru‚ÜíRUB, en‚ÜíUSD)

**Endpoints:**
- `GET /api/webapp/auth/verify` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `POST /api/webapp/auth/session` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ (–¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, —è–∑—ã–∫/–≤–∞–ª—é—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

---

### 1.2 Web Browser Auth (Session)

**User Flow:**
```
1. –û—Ç–∫—Ä—ã—Ç—å pvndora.app –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Telegram (OAuth/Web App)
3. –ü–æ–ª—É—á–∏—Ç—å session token
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Session token —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- [ ] API –∑–∞–ø—Ä–æ—Å—ã —Å token –ø—Ä–æ—Ö–æ–¥—è—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é
- [ ] Token expires –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ

---

## 2. üõçÔ∏è –ö–∞—Ç–∞–ª–æ–≥ –∏ –ü–æ–∏—Å–∫

### 2.1 –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ç–∞–ª–æ–≥–∞

**User Flow:**
```
1. –û—Ç–∫—Ä—ã—Ç—å Mini App ‚Üí –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
2. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã (—Ç–∏–ø: AI/Design/Dev/Music)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É (—Ü–µ–Ω–∞, –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –¢–æ–≤–∞—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è (API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫)
- [ ] –¶–µ–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≤–∞–ª—é—Ç–µ
- [ ] –§–∏–ª—å—Ç—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç (—Ç–∏–ø —Ç–æ–≤–∞—Ä–∞)
- [ ] –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ú–µ–¥–∏–∞ (—Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ) –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
- [ ] –ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ —Å `status='out_of_stock'` –∏–ª–∏ `'discontinued'`

**Endpoints:**
- `GET /api/webapp/catalog?type=ai&currency=RUB`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ö–∞—Ç–∞–ª–æ–≥ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω

---

### 2.2 –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ (RAG)

**User Flow:**
```
1. –í–≤–µ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å –≤ –ø–æ–∏—Å–∫: "gpt", "design tools", "music ai"
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
3. –ü–µ—Ä–µ–π—Ç–∏ –∫ —Ç–æ–≤–∞—Ä—É –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] RAG –ø–æ–∏—Å–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- [ ] –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–µ —Ç–æ–ª—å–∫–æ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)
- [ ] –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
- [ ] –ù–µ—Ç –ø—É—Å—Ç—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤

**Endpoints:**
- `GET /api/webapp/search?q=gpt+4`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã

---

### 2.3 –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–æ–≤–∞—Ä–∞

**User Flow:**
```
1. –û—Ç–∫—Ä—ã—Ç—å —Ç–æ–≤–∞—Ä –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é: —Ü–µ–Ω–∞, –æ–ø–∏—Å–∞–Ω–∏–µ, –≥–∞—Ä–∞–Ω—Ç–∏—è, —Ç–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Å—Ç–æ–∫–∞
4. –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É/–≤–∏—à–ª–∏—Å—Ç
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –¶–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞ (–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤ –≤–∞–ª—é—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- [ ] –ì–∞—Ä–∞–Ω—Ç–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è (warranty_days –∏–ª–∏ warranty_hours)
- [ ] –¢–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏: instant / preorder
- [ ] –°—Ç–∞—Ç—É—Å —Å—Ç–æ–∫–∞: available / low_stock / out_of_stock
- [ ] –ö–Ω–æ–ø–∫–∏ "–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É" / "–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ" —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ú–µ–¥–∏–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è (—Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ —Ç–æ–≤–∞—Ä–∞)

**Endpoints:**
- `GET /api/webapp/products/{product_id}`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞, –¥–µ–π—Å—Ç–≤–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç

---

## 3. üõí –ö–æ—Ä–∑–∏–Ω–∞

### 3.1 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É

**User Flow:**
```
1. –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–æ–≤–∞—Ä –ø–æ—è–≤–∏–ª—Å—è –≤ –∫–æ—Ä–∑–∏–Ω–µ
3. –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
4. –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä
5. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ—Ä–∑–∏–Ω—É (Redis)
- [ ] –ö–æ—Ä–∑–∏–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏
- [ ] –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∏ —Å–∫–∏–¥–∫–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è
- [ ] –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞ (—Å —É—á—ë—Ç–æ–º –ø—Ä–æ–º–æ–∫–æ–¥–∞)

**Endpoints:**
- `POST /api/webapp/cart/add`
- `PUT /api/webapp/cart/update`
- `DELETE /api/webapp/cart/remove`
- `POST /api/webapp/cart/promo/check`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞

---

### 3.2 Multi-item –∫–æ—Ä–∑–∏–Ω–∞ (Instant + Prepaid)

**User Flow:**
```
1. –î–æ–±–∞–≤–∏—Ç—å instant —Ç–æ–≤–∞—Ä (–µ—Å—Ç—å –≤ —Å—Ç–æ–∫–µ)
2. –î–æ–±–∞–≤–∏—Ç—å preorder —Ç–æ–≤–∞—Ä (–Ω–µ—Ç –≤ —Å—Ç–æ–∫–µ)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ instant/prepaid –≤ –∫–æ—Ä–∑–∏–Ω–µ
4. –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] Instant —Ç–æ–≤–∞—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- [ ] Prepaid —Ç–æ–≤–∞—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- [ ] –ü—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è order_items —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º fulfillment_type
- [ ] Instant –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è —Å—Ä–∞–∑—É, prepaid ‚Äî –ø–æ –¥–µ–¥–ª–∞–π–Ω—É

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ö–æ—Ä–∑–∏–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–∑–¥–µ–ª—è–µ—Ç instant/prepaid

---

## 4. üí≥ –ü–ª–∞—Ç–µ–∂–∏

### 4.1 –û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–æ–π (CrystalPay)

**User Flow:**
```
1. –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ ‚Üí –í—ã–±—Ä–∞—Ç—å "CARD"
2. –ü–æ–ª—É—á–∏—Ç—å payment_url
3. –ü–µ—Ä–µ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ ‚Üí –û–ø–ª–∞—Ç–∏—Ç—å
4. –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ Mini App
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] `payment_url` –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π (CrystalPay)
- [ ] –ü–ª–∞—Ç–µ–∂ –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ
- [ ] Webhook –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–ª–∞—Ç–µ–∂ (`POST /api/webhook/crystalpay`)
- [ ] –ó–∞–∫–∞–∑ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å—Ç–∞—Ç—É—Å `paid`
- [ ] Instant —Ç–æ–≤–∞—Ä—ã –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è —Å—Ä–∞–∑—É
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**Endpoints:**
- `POST /api/webapp/orders` ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
- `POST /api/webhook/crystalpay` ‚Üí webhook –æ—Ç CrystalPay

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü–ª–∞—Ç–µ–∂ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è, –∑–∞–∫–∞–∑ –æ–ø–ª–∞—á–µ–Ω

---

### 4.2 –û–ø–ª–∞—Ç–∞ —Å –±–∞–ª–∞–Ω—Å–∞

**User Flow:**
```
1. –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å (—á–µ—Ä–µ–∑ –ª—é–±–æ–π –º–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã)
2. –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É
3. –í—ã–±—Ä–∞—Ç—å "–û–ø–ª–∞—Ç–∏—Ç—å —Å –±–∞–ª–∞–Ω—Å–∞"
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–∏—Å–∞–Ω–∏–µ
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è (–ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã)
- [ ] –ü—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –æ–ø—Ü–∏—è "–° –±–∞–ª–∞–Ω—Å–∞"
- [ ] –ë–∞–ª–∞–Ω—Å —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ó–∞–∫–∞–∑ —Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ `paid`
- [ ] Transaction –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ `balance_transactions`

**Endpoints:**
- `POST /api/webapp/orders?payment_method=balance`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –û–ø–ª–∞—Ç–∞ —Å –±–∞–ª–∞–Ω—Å–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### 4.3 –î—Ä—É–≥–∏–µ –º–µ—Ç–æ–¥—ã –æ–ø–ª–∞—Ç—ã (Crypto)

**User Flow:**
```
1. –í—ã–±—Ä–∞—Ç—å –º–µ—Ç–æ–¥: Crypto
2. –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å payment_url
4. –û–ø–ª–∞—Ç–∏—Ç—å (—Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç—ë–∂)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –ú–µ—Ç–æ–¥ Crypto –¥–æ—Å—Ç—É–ø–µ–Ω (CrystalPay –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)
- [ ] `payment_url` –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –¥–ª—è –º–µ—Ç–æ–¥–∞
- [ ] Webhook –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –í—Å–µ –º–µ—Ç–æ–¥—ã –æ–ø–ª–∞—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç

---

### 4.4 –≠–∫—Å–ø–∏—Ä–∞—Ü–∏—è –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤

**User Flow:**
```
1. –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ (–ù–ï –æ–ø–ª–∞—á–∏–≤–∞—Ç—å)
2. –ü–æ–¥–æ–∂–¥–∞—Ç—å 15 –º–∏–Ω—É—Ç (expires_at)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–∞–∫–∞–∑ –æ—Ç–º–µ–Ω—ë–Ω (—á–µ—Ä–µ–∑ cron)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`
- [ ] `expires_at` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (15 –º–∏–Ω—É—Ç –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è)
- [ ] –ü–æ—Å–ª–µ 15 –º–∏–Ω—É—Ç cron (`unified.py`) –æ—Ç–º–µ–Ω—è–µ—Ç –∑–∞–∫–∞–∑
- [ ] –°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `cancelled`
- [ ] –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–æ–∫ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è

**Cron:** `GET /api/cron/unified` (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ù–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã –æ—Ç–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## 5. üì¶ –î–æ—Å—Ç–∞–≤–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤

### 5.1 Instant –¥–æ—Å—Ç–∞–≤–∫–∞

**User Flow:**
```
1. –û–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑ —Å instant —Ç–æ–≤–∞—Ä–æ–º
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–æ–≤–∞—Ä –¥–æ—Å—Ç–∞–≤–∏–ª—Å—è —Å—Ä–∞–∑—É
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å credentials –≤ –∑–∞–∫–∞–∑–µ
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã —Ç–æ–≤–∞—Ä –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É (QStash worker)
- [ ] `order_items.status` = `delivered`
- [ ] `delivery_content` —Å–æ–¥–µ—Ä–∂–∏—Ç credentials
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ Telegram
- [ ] –í Mini App credentials –≤–∏–¥–Ω—ã (—Å –∫–Ω–æ–ø–∫–æ–π –ø–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å)

**Worker:** `POST /api/workers/deliver-goods`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ Instant —Ç–æ–≤–∞—Ä—ã –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã

---

### 5.2 Prepaid –¥–æ—Å—Ç–∞–≤–∫–∞ (–ø–æ–¥ –∑–∞–∫–∞–∑)

**User Flow:**
```
1. –û–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑ —Å prepaid —Ç–æ–≤–∞—Ä–æ–º
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–æ–≤–∞—Ä –≤ —Å—Ç–∞—Ç—É—Å–µ "–û–∂–∏–¥–∞–Ω–∏–µ"
3. –î–æ–∂–¥–∞—Ç—å—Å—è –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è —Å—Ç–æ–∫–∞ (–∏–ª–∏ –∞–¥–º–∏–Ω –¥–æ–±–∞–≤–∏—Ç)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –¥–æ—Å—Ç–∞–≤–∫—É
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `prepaid`
- [ ] `order_items.status` = `waiting`
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å—Ç–∞—Ç—É—Å "–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è"
- [ ] –ö–æ–≥–¥–∞ —Å—Ç–æ–∫ –ø–æ—è–≤–ª—è–µ—Ç—Å—è ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ (cron `auto_alloc.py`)
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –¥–æ—Å—Ç–∞–≤–∫–µ

**Cron:** `GET /api/cron/auto_alloc` (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ Prepaid —Ç–æ–≤–∞—Ä—ã –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏ —Å—Ç–æ–∫–∞

---

### 5.3 –ß–∞—Å—Ç–∏—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ (Mixed order)

**User Flow:**
```
1. –û–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑ —Å instant + prepaid —Ç–æ–≤–∞—Ä–∞–º–∏
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ instant –¥–æ—Å—Ç–∞–≤–∏–ª–∏—Å—å —Å—Ä–∞–∑—É
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ prepaid –æ—Å—Ç–∞–ª–∏—Å—å –≤ –æ–∂–∏–¥–∞–Ω–∏–∏
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –æ—Ä–¥–µ—Ä–∞ (partial)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] Instant —Ç–æ–≤–∞—Ä—ã –¥–æ—Å—Ç–∞–≤–∏–ª–∏—Å—å
- [ ] Prepaid –æ—Å—Ç–∞–ª–∏—Å—å –≤ `waiting`
- [ ] Order status = `partial`
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤ UI

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ß–∞—Å—Ç–∏—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 5.4 –ê–≤—Ç–æ-–≤–æ–∑–≤—Ä–∞—Ç –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö prepaid

**User Flow:**
```
1. –°–æ–∑–¥–∞—Ç—å prepaid –∑–∞–∫–∞–∑
2. –û–ø–ª–∞—Ç–∏—Ç—å
3. –ü–æ–¥–æ–∂–¥–∞—Ç—å –∏—Å—Ç–µ—á–µ–Ω–∏—è `fulfillment_deadline` (–∏–ª–∏ —Å–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ-–≤–æ–∑–≤—Ä–∞—Ç
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –ü–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è –¥–µ–¥–ª–∞–π–Ω–∞ ‚Üí —Å—Ç–∞—Ç—É—Å `refunded`
- [ ] –°—Ä–µ–¥—Å—Ç–≤–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã –Ω–∞ –±–∞–ª–∞–Ω—Å
- [ ] Transaction —Å–æ–∑–¥–∞–Ω–∞ (type=refund)
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**Cron:** `GET /api/cron/refund_expired_prepaid` (–∫–∞–∂–¥—ã–π —á–∞—Å)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ prepaid –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è

---

## 6. ü§ñ Telegram Bot (PVNDORA)

### 6.1 –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

**User Flow:**
```
1. –û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞: /start
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –∫–∞–Ω–∞–ª (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã: /help, /faq, /terms
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] `/start` —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
- [ ] –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–æ (ru/en/de/etc)
- [ ] –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ) ‚Äî middleware –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –¥–æ –ø–æ–¥–ø–∏—Å–∫–∏
- [ ] –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –Ω–µ–ø–æ–¥–ø–∏—Å–∫–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –Ω–µ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ—Ç–∞
- [ ] –ö–æ–º–∞–Ω–¥—ã `/help`, `/faq`, `/terms` –æ—Ç–∫—Ä—ã–≤–∞—é—Ç Mini App —á–µ—Ä–µ–∑ inline –∫–Ω–æ–ø–∫–∏
- [ ] –ù–ï–¢ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (ReplyKeyboard) ‚Äî PVNDORA –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ Mini App, –Ω–µ –∫–∞–∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ –±–æ—Ç–µ

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ Mini App, –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** PVNDORA –±–æ—Ç –ù–ï –∏–º–µ–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å –∫–Ω–æ–ø–∫–∞–º–∏ (–∫–∞–∫ Discount –±–æ—Ç). –û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫:
- –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ Mini App (—á–µ—Ä–µ–∑ inline –∫–Ω–æ–ø–∫–∏)
- AI –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç (—Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∞–≥–µ–Ω—Ç–æ–º)
- –ö–æ–º–∞–Ω–¥—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã Mini App

---

### 6.2 AI –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –≤ –±–æ—Ç–µ

**User Flow:**
```
1. –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –±–æ—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ü–æ–∫–∞–∂–∏ —Ç–æ–≤–∞—Ä—ã", "–ß—Ç–æ —É —Ç–µ–±—è –µ—Å—Ç—å?")
2. –ü–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç AI –∞–≥–µ–Ω—Ç–∞
3. AI –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ Mini App (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
4. –ü–µ—Ä–µ–π—Ç–∏ –≤ Mini App —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è AI –∞–≥–µ–Ω—Ç–æ–º
- [ ] AI –æ—Ç–≤–µ—á–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ —Ç–æ–≤–∞—Ä–∞—Ö
- [ ] –ü—Ä–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ AI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç inline –∫–Ω–æ–ø–∫—É "üõç –ü–µ—Ä–µ–π—Ç–∏ –≤ –º–∞–≥–∞–∑–∏–Ω" (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Mini App)
- [ ] AI –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
- [ ] –ü—Ä–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ –ø–æ–∫—É–ø–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è Mini App

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ AI –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Mini App

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** PVNDORA –±–æ—Ç –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Ç–∞–ª–æ–≥ –Ω–∞–ø—Ä—è–º—É—é –≤ –±–æ—Ç–µ. –í—Å—ë –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑:
- AI –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç (–æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã)
- Inline –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ Mini App (–≥–¥–µ –∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–∫—É–ø–∫–∞)

---

### 6.3 –ö–æ–º–∞–Ω–¥—ã –∏ –ø–µ—Ä–µ—Ö–æ–¥ –≤ Mini App

**User Flow:**
```
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã: /help, /faq, /terms
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è inline –∫–Ω–æ–ø–∫–∏
3. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É ‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è Mini App
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å deep linking (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π startapp –ø–∞—Ä–∞–º–µ—Ç—Ä)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] `/help` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫–∏: FAQ, –£—Å–ª–æ–≤–∏—è, –ü–æ–¥–¥–µ—Ä–∂–∫–∞ (–≤—Å–µ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç Mini App)
- [ ] `/faq` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è FAQ –≤ Mini App
- [ ] `/terms` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –£—Å–ª–æ–≤–∏–π –≤ Mini App
- [ ] –í—Å–µ –∫–Ω–æ–ø–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ `startapp` –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- [ ] Mini App –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ä–∞–∑–¥–µ–ª–µ

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ö–æ–º–∞–Ω–¥—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç –≤ Mini App

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ó–∞–∫–∞–∑—ã, –∫–∞—Ç–∞–ª–æ–≥, –ø—Ä–æ—Ñ–∏–ª—å ‚Äî –≤—Å—ë –≤ Mini App. –ë–æ—Ç —Å–ª—É–∂–∏—Ç —Ç–æ–ª—å–∫–æ —Ç–æ—á–∫–æ–π –≤—Ö–æ–¥–∞.

---

## 7. üß† AI –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç

### 7.1 –ë–∞–∑–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**User Flow:**
```
1. –û—Ç–∫—Ä—ã—Ç—å AI —á–∞—Ç –≤ Mini App
2. –°–ø—Ä–æ—Å–∏—Ç—å: "–ö–∞–∫–∏–µ —Ç–æ–≤–∞—Ä—ã –µ—Å—Ç—å?", "–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç GPT-4?"
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç—ã
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] AI –æ—Ç–≤–µ—á–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ
- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î (–Ω–µ —Ö–∞—Ä–¥–∫–æ–¥)
- [ ] –¶–µ–Ω—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≤–∞–ª—é—Ç–µ
- [ ] –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (ru/en/de)

**Endpoints:**
- `POST /api/ai/chat`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ AI –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 7.2 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É —á–µ—Ä–µ–∑ AI

**User Flow:**
```
1. –°–ø—Ä–æ—Å–∏—Ç—å: "–î–æ–±–∞–≤—å GPT-4 –≤ –∫–æ—Ä–∑–∏–Ω—É"
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω
3. AI –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
4. –°–∫–∞–∑–∞—Ç—å "–û—Ñ–æ—Ä–º–∏ –∑–∞–∫–∞–∑"
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] AI –≤—ã–∑—ã–≤–∞–µ—Ç `add_to_cart`
- [ ] –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è AI –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ
- [ ] –ü—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `checkout_cart`
- [ ] –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] Payment URL –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü–æ–∫—É–ø–∫–∞ —á–µ—Ä–µ–∑ AI —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é

---

### 7.3 –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ AI

**User Flow:**
```
1. –°–ø—Ä–æ—Å–∏—Ç—å: "–ù–∞–π–¥–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –¥–∏–∑–∞–π–Ω–∞"
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
3. –ü–æ–ø—Ä–æ—Å–∏—Ç—å –ø–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–≤–∞—Ä
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] AI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `search_products` –∏–ª–∏ `get_catalog`
- [ ] –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã
- [ ] –ú–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ `get_product_details`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ AI —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### 7.4 –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞ —á–µ—Ä–µ–∑ AI

**User Flow:**
```
1. –°–∫–∞–∑–∞—Ç—å: "–£ –º–µ–Ω—è –ø—Ä–æ–±–ª–µ–º–∞ —Å –∞–∫–∫–∞—É–Ω—Ç–æ–º –∏–∑ –∑–∞–∫–∞–∑–∞ #C05E3EF9, item ID abc123..."
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ AI —Å–æ–∑–¥–∞–ª —Ç–∏–∫–µ—Ç
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ item_id —Å–æ—Ö—Ä–∞–Ω—ë–Ω
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] AI –ø–∞—Ä—Å–∏—Ç Order ID –∏ Item ID –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
- [ ] –í—ã–∑—ã–≤–∞–µ—Ç `create_support_ticket` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- [ ] –¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å `item_id`
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –¢–∏–∫–µ—Ç —á–µ—Ä–µ–∑ AI —Å–æ–∑–¥–∞—ë—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## 8. ‚≠ê –û—Ç–∑—ã–≤—ã –∏ –ö—ç—à–±—ç–∫

### 8.1 –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–∞

**User Flow:**
```
1. –û—Ç–∫—Ä—ã—Ç—å –∑–∞–∫–∞–∑ —Å delivered —Ç–æ–≤–∞—Ä–æ–º
2. –ù–∞–∂–∞—Ç—å "–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å: —Ä–µ–π—Ç–∏–Ω–≥ 5, —Ç–µ–∫—Å—Ç
4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à–±—ç–∫
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –û—Ç–∑—ã–≤ —Å–æ–∑–¥–∞—ë—Ç—Å—è (–ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É product_id, –ù–ï –∫–æ –≤—Å–µ–º—É –æ—Ä–¥–µ—Ä—É)
- [ ] –ö—ç—à–±—ç–∫ 5% –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è
- [ ] Transaction —Å–æ–∑–¥–∞—ë—Ç—Å—è (type=cashback)
- [ ] –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç
- [ ] –ö–Ω–æ–ø–∫–∞ "–û—Ç–∑—ã–≤ –æ—Å—Ç–∞–≤–ª–µ–Ω" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä–∞

**Endpoints:**
- `POST /api/webapp/reviews` (—Å `order_item_id`)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –û—Ç–∑—ã–≤ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Ç–æ–≤–∞—Ä—É, –∫—ç—à–±—ç–∫ –Ω–∞—á–∏—Å–ª–µ–Ω

---

### 8.2 –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—Ç–∑—ã–≤—ã (Multi-item order)

**User Flow:**
```
1. –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —Å 2 —Ç–æ–≤–∞—Ä–∞–º–∏
2. –û–ø–ª–∞—Ç–∏—Ç—å ‚Üí –ø–æ–ª—É—á–∏—Ç—å –æ–±–∞ —Ç–æ–≤–∞—Ä–∞
3. –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤ –Ω–∞ –ø–µ—Ä–≤—ã–π —Ç–æ–≤–∞—Ä
4. –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤ –Ω–∞ –≤—Ç–æ—Ä–æ–π —Ç–æ–≤–∞—Ä
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ–±–∞ –æ—Ç–∑—ã–≤–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –æ—Ç–¥–µ–ª—å–Ω–æ
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –ü–µ—Ä–≤—ã–π –æ—Ç–∑—ã–≤ —Å–æ–∑–¥–∞—ë—Ç—Å—è –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
- [ ] –í—Ç–æ—Ä–æ–π –æ—Ç–∑—ã–≤ —Å–æ–∑–¥–∞—ë—Ç—Å—è –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
- [ ] –ö—ç—à–±—ç–∫ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è –∑–∞ –∫–∞–∂–¥—ã–π –æ—Ç–∑—ã–≤ –æ—Ç–¥–µ–ª—å–Ω–æ
- [ ] –í UI –∫–∞–∂–¥—ã–π —Ç–æ–≤–∞—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–≤–æ–π —Å—Ç–∞—Ç—É—Å –æ—Ç–∑—ã–≤–∞

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –û—Ç–∑—ã–≤—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞

---

## 9. üé´ –ü—Ä–æ–º–æ–∫–æ–¥—ã

### 9.1 –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞

**User Flow:**
```
1. –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É
2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, -20%)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫–∏–¥–∫—É –≤ –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º–µ
4. –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–∫–∏–¥–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –≤ –∑–∞–∫–∞–∑–µ
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –ü—Ä–æ–º–æ–∫–æ–¥ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è (`POST /api/webapp/promo/check`)
- [ ] –°–∫–∏–¥–∫–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- [ ] –ü—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ —Å–∫–∏–¥–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –∑–∞–∫–∞–∑–µ (`discount_percent`)
- [ ] –ü—Ä–æ–º–æ–∫–æ–¥ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π

**Endpoints:**
- `POST /api/webapp/promo/check`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 9.2 –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤

**User Flow:**
```
1. –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ (usage_limit, expires_at)
2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ—Å–ª–µ –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–º–æ–∫–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ—Å–ª–µ expires_at –ø—Ä–æ–º–æ–∫–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –ü–æ—Å–ª–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è `usage_limit` –ø—Ä–æ–º–æ–∫–æ–¥ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è
- [ ] –ü–æ—Å–ª–µ `expires_at` –ø—Ä–æ–º–æ–∫–æ–¥ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è
- [ ] –û—à–∏–±–∫–∏ –ø–æ–Ω—è—Ç–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç

---

## 10. üéÅ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞

### 10.1 –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞

**User Flow:**
```
1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å ‚Üí –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
2. –ü–æ–ª—É—á–∏—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
3. –û—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É —Å –¥—Ä—É–≥–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ä–µ—Ñ–µ—Ä–∞–ª –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è (`/api/webapp/partner/referral-info`)
- [ ] –ü—Ä–∏ –∫–ª–∏–∫–µ –ø–æ —Å—Å—ã–ª–∫–µ `referrer_id` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- [ ] –†–µ—Ñ–µ—Ä–∞–ª –≤–∏–¥–µ–Ω –≤ —Å–µ—Ç–∏ —Ä–µ—Ñ–µ—Ä–µ—Ä–∞
- [ ] –£—Ä–æ–≤–µ–Ω—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π

**Endpoints:**
- `GET /api/webapp/partner/referral-info`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### 10.2 –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤

**User Flow:**
```
1. –†–µ—Ñ–µ—Ä–∞–ª –¥–µ–ª–∞–µ—Ç –ø–æ–∫—É–ø–∫—É
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –±–æ–Ω—É—Å –Ω–∞—á–∏—Å–ª–µ–Ω —Ä–µ—Ñ–µ—Ä–µ—Ä—É
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —É—Ä–æ–≤–Ω–∏ (L1, L2, L3)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –∑–∞–∫–∞–∑–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–∞ ‚Üí QStash worker –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- [ ] –ë–æ–Ω—É—Å –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è —Ä–µ—Ñ–µ—Ä–µ—Ä—É L1
- [ ] –ë–æ–Ω—É—Å –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è —Ä–µ—Ñ–µ—Ä–µ—Ä—É L2 (–µ—Å–ª–∏ –µ—Å—Ç—å)
- [ ] –ë–æ–Ω—É—Å –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è —Ä–µ—Ñ–µ—Ä–µ—Ä—É L3 (–µ—Å–ª–∏ –µ—Å—Ç—å)
- [ ] –ü—Ä–æ—Ü–µ–Ω—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã (–∏–∑ `referral_settings`)
- [ ] Transaction —Å–æ–∑–¥–∞—ë—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤—Å–µ–º —Ä–µ—Ñ–µ—Ä–µ—Ä–∞–º

**Worker:** `POST /api/workers/calculate-referral`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞ –≤—Å–µ —É—Ä–æ–≤–Ω–∏

---

### 10.3 –ö–∞—Ä—å–µ—Ä–Ω—ã–µ —É—Ä–æ–≤–Ω–∏

**User Flow:**
```
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å (LOCKED / PROXY / OPERATOR / ARCHITECT)
2. –°–¥–µ–ª–∞—Ç—å –ø–æ–∫—É–ø–∫–∏ –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫—É
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–π
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –£—Ä–æ–≤–µ–Ω—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º (turnover_usd, total_purchases)
- [ ] –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞ ‚Üí —É—Ä–æ–≤–µ–Ω—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
- [ ] –ö–æ–º–∏—Å—Å–∏–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ —É—Ä–æ–≤–Ω—é
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–µ

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ö–∞—Ä—å–µ—Ä–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 10.4 VIP –ü–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–æ

**User Flow:**
```
1. –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ VIP –ø–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–æ
2. –ê–¥–º–∏–Ω –æ–¥–æ–±—Ä—è–µ—Ç/–æ—Ç–∫–ª–æ–Ω—è–µ—Ç
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–∞
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã/—Å–∫–∏–¥–∫–∏
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ –ø—Ä–æ—Ñ–∏–ª—å
- [ ] –ê–¥–º–∏–Ω –≤–∏–¥–∏—Ç –∑–∞—è–≤–∫—É –≤ Admin Panel
- [ ] –ü—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ ‚Üí `is_partner = true`
- [ ] –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∞–∫—Ç–∏–≤–Ω—ã (—Å–∫–∏–¥–∫–∏, –∫–æ–º–∏—Å—Å–∏–∏)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ VIP –ø–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## 11. üéüÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –ó–∞–º–µ–Ω—ã

### 11.1 –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞ –Ω–∞ –∑–∞–º–µ–Ω—É

**User Flow:**
```
1. –û—Ç–∫—Ä—ã—Ç—å –∑–∞–∫–∞–∑ —Å delivered —Ç–æ–≤–∞—Ä–æ–º
2. –ù–∞–∂–∞—Ç—å "–°–æ–æ–±—â–∏—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–µ"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ
4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω —Å item_id
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ AI —á–∞—Ç –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
- [ ] `item_id` —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ —Ç–∏–∫–µ—Ç–µ
- [ ] `order_id` —Å–æ—Ö—Ä–∞–Ω—ë–Ω
- [ ] –°—Ç–∞—Ç—É—Å `open`
- [ ] –ê–¥–º–∏–Ω –≤–∏–¥–∏—Ç —Ç–∏–∫–µ—Ç –≤ Admin Panel

**Endpoints:**
- `POST /api/webapp/support/tickets` (–∏–ª–∏ —á–µ—Ä–µ–∑ AI)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

---

### 11.2 –û–¥–æ–±—Ä–µ–Ω–∏–µ –∏ –∑–∞–º–µ–Ω–∞

**User Flow:**
```
1. –ê–¥–º–∏–Ω –æ–¥–æ–±—Ä—è–µ—Ç —Ç–∏–∫–µ—Ç –Ω–∞ –∑–∞–º–µ–Ω—É
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ QStash worker –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
3. –ï—Å–ª–∏ —Å—Ç–æ–∫ –µ—Å—Ç—å ‚Üí —Ç–æ–≤–∞—Ä –∑–∞–º–µ–Ω—ë–Ω —Å—Ä–∞–∑—É
4. –ï—Å–ª–∏ —Å—Ç–æ–∫–∞ –Ω–µ—Ç ‚Üí —Ç–æ–≤–∞—Ä –∑–∞–º–µ–Ω—ë–Ω –ø—Ä–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏ (cron)
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –ê–¥–º–∏–Ω –æ–¥–æ–±—Ä—è–µ—Ç —Ç–∏–∫–µ—Ç ‚Üí —Å—Ç–∞—Ç—É—Å `approved`
- [ ] QStash worker –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (`POST /api/workers/process-replacement`)
- [ ] –ï—Å–ª–∏ —Å—Ç–æ–∫ –µ—Å—Ç—å ‚Üí `delivery_content` –æ–±–Ω–æ–≤–ª—ë–Ω
- [ ] –ï—Å–ª–∏ —Å—Ç–æ–∫–∞ –Ω–µ—Ç ‚Üí —Ç–∏–∫–µ—Ç –æ—Å—Ç–∞—ë—Ç—Å—è `approved`, –∂–¥—ë—Ç —Å—Ç–æ–∫
- [ ] Cron `auto_alloc.py` –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏ —Å—Ç–æ–∫–∞
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏ –∑–∞–º–µ–Ω–µ
- [ ] –ó–∞–º–µ–Ω—è–µ—Ç—Å—è –¢–û–õ–¨–ö–û –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–≤–∞—Ä, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–µ —Ç—Ä–æ–≥–∞—é—Ç—Å—è

**Worker:** `POST /api/workers/process-replacement`  
**Cron:** `GET /api/cron/auto_alloc`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ó–∞–º–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞

---

### 11.3 –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ (Refund)

**User Flow:**
```
1. –°–æ–∑–¥–∞—Ç—å —Ç–∏–∫–µ—Ç –Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç
2. –ê–¥–º–∏–Ω –æ–¥–æ–±—Ä—è–µ—Ç
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å—Ä–µ–¥—Å—Ç–≤–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –ü—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ ‚Üí —Å—Ä–µ–¥—Å—Ç–≤–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã –Ω–∞ –±–∞–ª–∞–Ω—Å
- [ ] Order status = `refunded`
- [ ] Transaction —Å–æ–∑–¥–∞–Ω–∞ (type=refund)
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –í–æ–∑–≤—Ä–∞—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## 12. üìä –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 12.1 –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è

**User Flow:**
```
1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –≤ Mini App
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é: –±–∞–ª–∞–Ω—Å, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –ë–∞–ª–∞–Ω—Å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è (total_saved, total_purchases)
- [ ] –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –≤–∏–¥–Ω–∞
- [ ] –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- [ ] –Ø–∑—ã–∫ –∏ –≤–∞–ª—é—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

**Endpoints:**
- `GET /api/webapp/profile`
- `GET /api/webapp/balance/history`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω

---

### 12.2 –ò–∑–±—Ä–∞–Ω–Ω–æ–µ (Wishlist)

**User Flow:**
```
1. –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–æ–≤–∞—Ä –ø–æ—è–≤–∏–ª—Å—è –≤ —Å–ø–∏—Å–∫–µ
3. –£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏ —Å—Ç–æ–∫–∞ (–µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –±—ã–ª out_of_stock)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ wishlist
- [ ] –°–ø–∏—Å–æ–∫ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü—Ä–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏ —Å—Ç–æ–∫–∞ ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ –±—ã–ª out_of_stock)

**Endpoints:**
- `POST /api/user/wishlist/{product_id}`
- `GET /api/user/wishlist`
- `DELETE /api/user/wishlist/{product_id}`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ Wishlist —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## 13. üì¢ –†–∞—Å—Å—ã–ª–∫–∏ (Admin Bot)

### 13.1 –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–∏

**User Flow (–ê–¥–º–∏–Ω):**
```
1. –û—Ç–∫—Ä—ã—Ç—å Admin Bot
2. /broadcast
3. –í—ã–±—Ä–∞—Ç—å –±–æ—Ç (pvndora / discount)
4. –í—ã–±—Ä–∞—Ç—å –∞—É–¥–∏—Ç–æ—Ä–∏—é (all / active / inactive / vip / buyers)
5. –í—ã–±—Ä–∞—Ç—å —è–∑—ã–∫–∏
6. –í–≤–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç
7. –î–æ–±–∞–≤–∏—Ç—å –º–µ–¥–∏–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
8. –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
9. –û—Ç–ø—Ä–∞–≤–∏—Ç—å
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] FSM flow —Ä–∞–±–æ—Ç–∞–µ—Ç (–≤—Å–µ —à–∞–≥–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç)
- [ ] –ú–µ–¥–∏–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è (Admin Bot ‚Üí —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ü–µ–ª–µ–≤–æ–π –±–æ—Ç)
- [ ] –†–∞—Å—Å—ã–ª–∫–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ –ë–î (`broadcast_messages`)
- [ ] Recipients —Å–æ–∑–¥–∞—é—Ç—Å—è (`broadcast_recipients`)
- [ ] QStash –±–∞—Ç—á–∏ —Å—Ç–∞–≤—è—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å
- [ ] Worker –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- [ ] –°—Ç–∞—Ç—É—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è (sent_count, failed_count)
- [ ] –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è (`bot_blocked_at IS NULL`)

**Endpoints:**
- Admin Bot: `/broadcast` command
- Worker: `POST /api/workers/send-broadcast`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –†–∞—Å—Å—ã–ª–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–µ–¥–∏–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

---

### 13.2 –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–∏

**User Flow (–ê–¥–º–∏–Ω):**
```
1. /broadcasts
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ä–∞—Å—Å—ã–ª–æ–∫
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å (sent/total)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –°–ø–∏—Å–æ–∫ —Ä–∞—Å—Å—ã–ª–æ–∫ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- [ ] –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- [ ] –°—Ç–∞—Ç—É—Å—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã (sending / sent / failed)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## 14. üí∞ Discount Bot (–î–∏—Å–∫–æ–Ω—Ç-–∫–∞–Ω–∞–ª)

### 14.1 –ü–æ–∫—É–ø–∫–∞ —á–µ—Ä–µ–∑ Discount Bot

**User Flow:**
```
1. –û—Ç–∫—Ä—ã—Ç—å Discount Bot
2. –í—ã–±—Ä–∞—Ç—å —Ç–æ–≤–∞—Ä
3. –û–ø–ª–∞—Ç–∏—Ç—å
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–ª–æ–∂–µ–Ω–Ω—É—é –¥–æ—Å—Ç–∞–≤–∫—É (1-4 —á–∞—Å–∞)
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–ø–ª—ã–π –æ—Ñ—Ñ–µ—Ä –Ω–∞ PVNDORA –ø–æ—Å–ª–µ –¥–æ—Å—Ç–∞–≤–∫–∏
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ
- [ ] –ü–æ–∫—É–ø–∫–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç
- [ ] –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å `source_channel='discount'`
- [ ] –î–æ—Å—Ç–∞–≤–∫–∞ –æ—Ç–ª–æ–∂–µ–Ω–∞ (QStash —Å delay 1-4 —á–∞—Å–∞)
- [ ] –ü–æ—Å–ª–µ –¥–æ—Å—Ç–∞–≤–∫–∏ ‚Üí warm-up –æ—Ñ—Ñ–µ—Ä –Ω–∞ PVNDORA
- [ ] –ü—Ä–æ–º–æ–∫–æ–¥ -50% –¥–ª—è –ª–æ—è–ª—å–Ω—ã—Ö (3+ –ø–æ–∫—É–ø–æ–∫)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ Discount Bot —Ä–∞–±–æ—Ç–∞–µ—Ç, –æ—Ñ—Ñ–µ—Ä—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

---

### 14.2 –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ (Insurance)

**User Flow:**
```
1. –ö—É–ø–∏—Ç—å —Ç–æ–≤–∞—Ä —Å –æ–ø—Ü–∏–µ–π —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏
2. –°–æ–æ–±—â–∏—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–µ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–º–µ–Ω—É —á–µ—Ä–µ–∑ —Å—Ç—Ä–∞—Ö–æ–≤–∫—É
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –ø–æ–∫—É–ø–∫–∏
- [ ] –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–µ ‚Üí –∑–∞–º–µ–Ω–∞ —á–µ—Ä–µ–∑ —Å—Ç—Ä–∞—Ö–æ–≤–∫—É
- [ ] –õ–æ–≥–∏–∫–∞ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (`insurance.py`)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## 15. üîÑ –§–æ–Ω–æ–≤—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã (Cron Jobs)

### 15.1 –ê–≤—Ç–æ-–¥–æ—Å—Ç–∞–≤–∫–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```
1. –°–æ–∑–¥–∞—Ç—å paid –∑–∞–∫–∞–∑
2. –ü–æ–¥–æ–∂–¥–∞—Ç—å 5 –º–∏–Ω—É—Ç (cron unified.py)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–æ–≤–∞—Ä –¥–æ—Å—Ç–∞–≤–ª–µ–Ω
```

**Cron:** `GET /api/cron/unified` (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ê–≤—Ç–æ-–¥–æ—Å—Ç–∞–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### 15.2 –≠–∫—Å–ø–∏—Ä–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```
1. –°–æ–∑–¥–∞—Ç—å pending –∑–∞–∫–∞–∑ (–ù–ï –æ–ø–ª–∞—á–∏–≤–∞—Ç—å)
2. –ü–æ–¥–æ–∂–¥–∞—Ç—å 15 –º–∏–Ω—É—Ç
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–∞–∫–∞–∑ –æ—Ç–º–µ–Ω—ë–Ω
```

**Cron:** `GET /api/cron/unified` (task 1)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –≠–∫—Å–ø–∏—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### 15.3 –ê–≤—Ç–æ-–∑–∞–º–µ–Ω—ã (–∏–∑ —Ç–∏–∫–µ—Ç–æ–≤)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```
1. –û–¥–æ–±—Ä–∏—Ç—å —Ç–∏–∫–µ—Ç –Ω–∞ –∑–∞–º–µ–Ω—É
2. –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–æ–∫ –¥–ª—è —Ç–æ–≤–∞—Ä–∞
3. –ü–æ–¥–æ–∂–¥–∞—Ç—å 5 –º–∏–Ω—É—Ç (cron auto_alloc.py)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–∞–º–µ–Ω–∞ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞
```

**Cron:** `GET /api/cron/auto_alloc`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ê–≤—Ç–æ-–∑–∞–º–µ–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç

---

### 15.4 Polling –ø–ª–∞—Ç–µ–∂–µ–π (fallback)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```
1. –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —Å CrystalPay (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
2. –û–ø–ª–∞—Ç–∏—Ç—å
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ polling –æ–±–Ω–∞—Ä—É–∂–∏–ª –ø–ª–∞—Ç–µ–∂ (–µ—Å–ª–∏ webhook –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª)
```

**Cron:** `GET /api/cron/check_pending_payments` (–∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ Polling —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ fallback

---

### 15.5 –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∫—É—Ä—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, RUB/USD)
2. –ü–æ–¥–æ–∂–¥–∞—Ç—å —á–∞—Å
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫—É—Ä—Å –æ–±–Ω–æ–≤–∏–ª—Å—è
```

**Cron:** `GET /api/cron/update_exchange_rates` (–∫–∞–∂–¥—ã–π —á–∞—Å)  
**–ò–ª–∏:** Task 3 –≤ `unified.py` (–∫–∞–∂–¥—ã–π —á–∞—Å)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è

---

### 15.6 –†–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```
1. –°–æ–∑–¥–∞—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (last_activity 7-14 –¥–Ω–µ–π –Ω–∞–∑–∞–¥)
2. –ü–æ–¥–æ–∂–¥–∞—Ç—å –¥–æ 12:00 UTC
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏—à–ª–æ
```

**Cron:** `GET /api/cron/reengagement` (12:00 UTC –µ–∂–µ–¥–Ω–µ–≤–Ω–æ)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –†–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### 15.7 –ù–æ—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```
1. –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—é —Å—Ç–∞—Ä—à–µ 30 –º–∏–Ω—É—Ç
2. –ü–æ–¥–æ–∂–¥–∞—Ç—å –¥–æ 03:00 UTC
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∞
```

**Cron:** `GET /api/cron/daily_cleanup` (03:00 UTC –µ–∂–µ–¥–Ω–µ–≤–Ω–æ)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –û—á–∏—Å—Ç–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### 15.8 –ù–∏–∑–∫–∏–π —Å—Ç–æ–∫ (–ê–ª–µ—Ä—Ç—ã –∞–¥–º–∏–Ω–∞–º)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```
1. –°–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä —Å low_stock (< 5 –µ–¥–∏–Ω–∏—Ü)
2. –ü–æ–¥–æ–∂–¥–∞—Ç—å 30 –º–∏–Ω—É—Ç
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∞–¥–º–∏–Ω—ã –ø–æ–ª—É—á–∏–ª–∏ –∞–ª–µ—Ä—Ç
```

**Cron:** `GET /api/cron/low_stock_alert` (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ê–ª–µ—Ä—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç

---

## 16. üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –í–∞–ª–∏–¥–∞—Ü–∏—è

### 16.1 –í–∞–ª–∏–¥–∞—Ü–∏—è Telegram Auth

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] `initData` –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è (HMAC SHA256)
- [ ] –ü–æ–¥–¥–µ–ª—å–Ω—ã–π `initData` –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è
- [ ] –ò—Å—Ç—ë–∫—à–∏–π `initData` (auth_date > 24h) –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è
- [ ] Session tokens –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è (–¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–∞

---

### 16.2 QStash Signature Verification

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] Worker endpoints –ø—Ä–æ–≤–µ—Ä—è—é—Ç –ø–æ–¥–ø–∏—Å—å QStash
- [ ] –ü–æ–¥–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è (401)
- [ ] URL verification —Ä–∞–±–æ—Ç–∞–µ—Ç (fallback –Ω–∞ —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ QStash workers –∑–∞—â–∏—â–µ–Ω—ã

---

### 16.3 Rate Limiting

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] API endpoints –∏–º–µ—é—Ç rate limiting (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
- [ ] –ë–æ—Ç –∏–º–µ–µ—Ç rate limiting –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Å–ø–∞–º–∞

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ Rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### 16.4 –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –í—Å–µ API endpoints –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (Pydantic)
- [ ] SQL injection –∑–∞—â–∏—Ç–∞ (–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
- [ ] XSS –∑–∞—â–∏—Ç–∞ (sanitization –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å: –ü–æ–∫—É–ø–∫–∞ ‚Üí –û–ø–ª–∞—Ç–∞ ‚Üí –î–æ—Å—Ç–∞–≤–∫–∞

**–ü–æ–ª–Ω—ã–π flow:**
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Mini App
2. –í—ã–±–∏—Ä–∞–µ—Ç —Ç–æ–≤–∞—Ä ‚Üí –î–æ–±–∞–≤–ª—è–µ—Ç –≤ –∫–æ—Ä–∑–∏–Ω—É
3. –û—Ñ–æ—Ä–º–ª—è–µ—Ç –∑–∞–∫–∞–∑ ‚Üí –í—ã–±–∏—Ä–∞–µ—Ç –º–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã (–∫–∞—Ä—Ç–∞)
4. –û–ø–ª–∞—á–∏–≤–∞–µ—Ç –Ω–∞ CrystalPay
5. Webhook –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–ª–∞—Ç–µ–∂
6. QStash worker –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä
7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç credentials
8. –û—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ç–∑—ã–≤ ‚Üí –ü–æ–ª—É—á–∞–µ—Ç –∫—ç—à–±—ç–∫
9. –†–µ—Ñ–µ—Ä–∞–ª—ã –ø–æ–ª—É—á–∞—é—Ç –±–æ–Ω—É—Å—ã
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç end-to-end –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –í—Å–µ —Å—Ç–∞—Ç—É—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç
- [ ] –í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é

---

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å: –ó–∞–º–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞

**–ü–æ–ª–Ω—ã–π flow:**
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∞–µ—Ç –æ –ø—Ä–æ–±–ª–µ–º–µ (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–≤–∞—Ä)
2. –¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å item_id
3. –ê–¥–º–∏–Ω –æ–¥–æ–±—Ä—è–µ—Ç
4. QStash worker –∏—â–µ—Ç —Å—Ç–æ–∫
5. –ï—Å–ª–∏ —Å—Ç–æ–∫ –µ—Å—Ç—å ‚Üí –ó–∞–º–µ–Ω—è–µ—Ç —Å—Ä–∞–∑—É
6. –ï—Å–ª–∏ —Å—Ç–æ–∫–∞ –Ω–µ—Ç ‚Üí Cron –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏
7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –¢–∏–∫–µ—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ç–æ–≤–∞—Ä—É (–ù–ï –∫–æ –≤—Å–µ–º—É –æ—Ä–¥–µ—Ä—É)
- [ ] –ó–∞–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä
- [ ] –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –Ω–µ —Ç—Ä–æ–≥–∞—é—Ç—Å—è
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ó–∞–º–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞

---

## –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

### ‚úÖ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

- [ ] Vercel Pro –ø–ª–∞–Ω (–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –ø—Ä–æ–µ–∫—Ç)
- [ ] –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] BASE_URL / WEBAPP_URL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] QStash —Ç–æ–∫–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Supabase production DB –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- [ ] Upstash Redis –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –í—Å–µ webhooks –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã (Telegram, –ø–ª–∞—Ç–µ–∂–∏)

---

### ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- [ ] Telegram auth –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è
- [ ] QStash signatures –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è
- [ ] SQL injection –∑–∞—â–∏—Ç–∞
- [ ] XSS –∑–∞—â–∏—Ç–∞
- [ ] Rate limiting –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏ –Ω–µ –≤ –∫–æ–¥–µ

---

### ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- [ ] –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ flows —Ä–∞–±–æ—Ç–∞—é—Ç (–ø–æ–∫—É–ø–∫–∞, –¥–æ—Å—Ç–∞–≤–∫–∞, –∑–∞–º–µ–Ω–∞)
- [ ] –ü–ª–∞—Ç–µ–∂–∏ —Ä–∞–±–æ—Ç–∞—é—Ç (–≤—Å–µ –º–µ—Ç–æ–¥—ã)
- [ ] –î–æ—Å—Ç–∞–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (instant, prepaid, mixed)
- [ ] –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –û—Ç–∑—ã–≤—ã –∏ –∫—ç—à–±—ç–∫ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] AI –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –†–∞—Å—Å—ã–ª–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### ‚úÖ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å

- [ ] QStash workers –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –æ—à–∏–±–∫–∏
- [ ] Fallback –¥–ª—è webhooks (polling)
- [ ] Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ (Vercel Logs, QStash Logs)

---

### ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- [ ] API –æ—Ç–≤–µ—Ç—ã < 2 —Å–µ–∫—É–Ω–¥
- [ ] QStash workers –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è < 60 —Å–µ–∫—É–Ω–¥
- [ ] Cron jobs –Ω–µ —Ç–∞–π–º–∞—É—Ç—è—Ç—Å—è
- [ ] Database queries –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã (–∏–Ω–¥–µ–∫—Å—ã)
- [ ] Redis –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### ‚úÖ –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è

- [ ] –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω—ã (9 —è–∑—ã–∫–æ–≤)
- [ ] –¶–µ–Ω—ã –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –≤–∞–ª—é—Ç—É
- [ ] –î–∞—Ç–∞/–≤—Ä–µ–º—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ –ª–æ–∫–∞–ª–∏
- [ ] AI –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —è–∑—ã–∫–µ

---

### ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- [ ] Vercel Logs –¥–æ—Å—Ç—É–ø–Ω—ã
- [ ] QStash Dashboard –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] Supabase Dashboard –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] –ê–ª–µ—Ä—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (low stock, errors)
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è (–µ—Å–ª–∏ –µ—Å—Ç—å)

---

### ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [ ] API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞
- [ ] README –æ–±–Ω–æ–≤–ª—ë–Ω
- [ ] Environment variables –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] Admin guide –≥–æ—Ç–æ–≤

---

## üìù –û—Ç—á—ë—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –∑–∞–ø–æ–ª–Ω–∏ —Ç–∞–±–ª–∏—Ü—É:

| –ú–æ–¥—É–ª—å | –°—Ç–∞—Ç—É—Å | –ù–∞–π–¥–µ–Ω–æ –±–∞–≥–æ–≤ | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
|--------|--------|---------------|-------------|
| –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è | ‚¨ú | - | - |
| –ö–∞—Ç–∞–ª–æ–≥ | ‚¨ú | - | - |
| –ö–æ—Ä–∑–∏–Ω–∞ | ‚¨ú | - | - |
| –ü–ª–∞—Ç–µ–∂–∏ | ‚¨ú | - | - |
| –î–æ—Å—Ç–∞–≤–∫–∞ | ‚¨ú | - | - |
| Telegram Bot | ‚¨ú | - | - |
| AI –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç | ‚¨ú | - | - |
| –û—Ç–∑—ã–≤—ã | ‚¨ú | - | - |
| –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ | ‚¨ú | - | - |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ | ‚¨ú | - | - |
| –†–∞—Å—Å—ã–ª–∫–∏ | ‚¨ú | - | - |
| Discount Bot | ‚¨ú | - | - |
| Cron Jobs | ‚¨ú | - | - |

**–ò—Ç–æ–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ:** ‚¨ú –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É / ‚¨ú –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

–ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã, –æ–ø–∏—à–∏ –∏—Ö –∑–¥–µ—Å—å:

1. **–ü—Ä–æ–±–ª–µ–º–∞:** [–æ–ø–∏—Å–∞–Ω–∏–µ]  
   **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è / –°—Ä–µ–¥–Ω—è—è / –ù–∏–∑–∫–∞—è  
   **–°—Ç–∞—Ç—É—Å:** –û—Ç–∫—Ä—ã—Ç–æ / –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-01-09
