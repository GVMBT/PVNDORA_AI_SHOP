# UI/UX Improvements & System Enhancements

> –î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: 2025-12-08
> –°—Ç–∞—Ç—É—Å: –í —Ä–∞–±–æ—Ç–µ

## üî¥ –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

### 1. CrystalPay –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **–§–∞–π–ª:** `src/components/checkout/PaymentMethodDialog.jsx`
- **–§–∞–π–ª:** `locales/ru.json` –∏ –¥—Ä—É–≥–∏–µ –ª–æ–∫–∞–ª–∏
- **–ó–∞–¥–∞—á–∞:** 
  - [ ] –ò–∑–º–µ–Ω–∏—Ç—å `selectedGateway` default —Å `'rukassa'` –Ω–∞ `'crystalpay'`
  - [ ] –ò–∑–º–µ–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç `"paymentInfo"` –Ω–∞ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π "–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–ª–∞—Ç–∞"

### 2. –ö–Ω–æ–ø–∫–∞ "–ö—É–ø–∏—Ç—å" –≤–µ–¥—ë—Ç –≤ –∫–æ—Ä–∑–∏–Ω—É
- **–§–∞–π–ª:** `src/pages/CatalogPage.jsx`
- **–ó–∞–¥–∞—á–∞:**
  - [ ] –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ "–ö—É–ø–∏—Ç—å" ‚Üí –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É ‚Üí –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ checkout
  - [ ] –ù–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å ProductPage

### 3. –£–±—Ä–∞—Ç—å auth flash –≤ ProfilePage
- **–§–∞–π–ª:** `src/pages/ProfilePage.jsx`
- **–ó–∞–¥–∞—á–∞:**
  - [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å Skeleton –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏, –Ω–µ LoginPage
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö

---

## üü° –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

### 4. –¢–∞–π–º–µ—Ä –¥–ª—è prepaid –∑–∞–∫–∞–∑–æ–≤ + cron refund
- **–§–∞–π–ª—ã:** 
  - `src/pages/OrdersPage.jsx`
  - `api/cron/refund_expired_prepaid.py` (–Ω–æ–≤—ã–π)
  - `vercel.json`
- **–ó–∞–¥–∞—á–∞:**
  - [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–∞–π–º–µ—Ä "–ì–∞—Ä–∞–Ω—Ç–∏—è –ø–æ—Å—Ç–∞–≤–∫–∏ –¥–æ X –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç" –¥–ª—è prepaid/fulfilling
  - [ ] –°–æ–∑–¥–∞—Ç—å cron job –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ refund –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö prepaid

### 5. UI –∑–∞–∫–∞–∑–æ–≤ - Accordion + Infinite Scroll
- **–§–∞–π–ª:** `src/pages/OrdersPage.jsx`
- **–§–∞–π–ª:** `core/routers/webapp/orders.py`
- **–ó–∞–¥–∞—á–∞:**
  - [ ] –î–æ–±–∞–≤–∏—Ç—å collapse –¥–ª—è –ø–æ–∑–∏—Ü–∏–π (–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å 2, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ –∫–ª–∏–∫—É)
  - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å infinite scroll —Å IntersectionObserver
  - [ ] –î–æ–±–∞–≤–∏—Ç—å limit/offset –≤ API `/api/webapp/orders`
  - [ ] –î–æ–±–∞–≤–∏—Ç—å tabs: "–ê–∫—Ç–∏–≤–Ω—ã–µ | –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ | –í—Å–µ"

### 6. –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ cron jobs
- **–§–∞–π–ª—ã:**
  - `api/cron/refund_expired_prepaid.py` (–Ω–æ–≤—ã–π)
  - `api/cron/stock_alerts.py` (–Ω–æ–≤—ã–π)
  - `vercel.json`
- **–ó–∞–¥–∞—á–∞:**
  - [ ] `refund_expired_prepaid` - –∞–≤—Ç–æ–≤–æ–∑–≤—Ä–∞—Ç –¥–ª—è prepaid —Å –∏—Å—Ç—ë–∫—à–∏–º fulfillment_deadline
  - [ ] `stock_alerts` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω—É –æ –Ω–∏–∑–∫–æ–º —Å—Ç–æ–∫–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üü¢ –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

### 7. expires_at –Ω–∞ —É—Ä–æ–≤–Ω–µ order_items
- **–§–∞–π–ª—ã:**
  - `supabase/migrations/XXX_item_level_expiry.sql`
  - `core/routers/workers.py`
  - `src/pages/OrdersPage.jsx`
- **–ó–∞–¥–∞—á–∞:**
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É `expires_at` –≤ `order_items`
  - [ ] –ü—Ä–∏ –¥–æ—Å—Ç–∞–≤–∫–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å expires_at = now + product.duration_days
  - [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –¥–∞—Ç—ã –∏—Å—Ç–µ—á–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏

### 8. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å —Ñ–∞–π–ª–∞–º–∏
- **–§–∞–π–ª—ã:**
  - `supabase/migrations/XXX_instruction_files.sql`
  - `src/pages/OrdersPage.jsx`
  - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
- **–ó–∞–¥–∞—á–∞:**
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É `instruction_files` (JSONB) –≤ `products`
  - [ ] UI –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ (—Å–∫—Ä–∏–ø—Ç—ã, VPN –∫–æ–Ω—Ñ–∏–≥–∏ –∏ —Ç.–¥.)

### 9. –î–µ—Ä–µ–≤–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ (–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ)
- **–§–∞–π–ª—ã:**
  - `core/routers/webapp/profile.py`
  - `src/pages/ProfilePage.jsx`
  - –ù–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `ReferralNetwork.jsx`
- **–ó–∞–¥–∞—á–∞:**
  - [ ] API endpoint `/api/webapp/referral/network`
  - [ ] –î—Ä–µ–≤–æ–≤–∏–¥–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ —Å earnings

### 10. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ "–≤—Ä–µ–º—è –æ–ø–ª–∞—Ç—ã" –∏ "—Å—Ä–æ–∫ –ª–∏—Ü–µ–Ω–∑–∏–∏"
- **–§–∞–π–ª:** `src/pages/OrdersPage.jsx`
- **–ó–∞–¥–∞—á–∞:**
  - [ ] –í–∏–∑—É–∞–ª—å–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –¥–≤–∞ —Ç–∏–ø–∞ "–∏—Å—Ç–µ–∫–∞–µ—Ç":
    - Pending: "–û—Å—Ç–∞–ª–æ—Å—å X –º–∏–Ω—É—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É"
    - Delivered: "–õ–∏—Ü–µ–Ω–∑–∏—è –¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ X"

### 11. –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Å—Ç—Ä–æ–∫
- **–§–∞–π–ª—ã:** `locales/*.json`
- **–ó–∞–¥–∞—á–∞:**
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ hardcoded —Å—Ç—Ä–æ–∫–∏ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∫–ª—é—á–∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏

### 12. –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å
- **–ó–∞–¥–∞—á–∞:**
  - [ ] Dead Letter Queue –¥–ª—è –Ω–µ—É–¥–∞—á–Ω—ã—Ö –¥–æ—Å—Ç–∞–≤–æ–∫
  - [ ] Webhook replay –∏–∑ –∞–¥–º–∏–Ω–∫–∏
  - [ ] Rate limiting –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ endpoints
  - [ ] Alert system (Telegram notifications –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö)

---

## –ü—Ä–æ–≥—Ä–µ—Å—Å

| # | –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å |
|---|--------|--------|
| 1 | CrystalPay –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | ‚úÖ |
| 2 | –ö–Ω–æ–ø–∫–∞ "–ö—É–ø–∏—Ç—å" ‚Üí –∫–æ—Ä–∑–∏–Ω–∞ | ‚úÖ |
| 3 | –£–±—Ä–∞—Ç—å auth flash | ‚úÖ |
| 4 | –¢–∞–π–º–µ—Ä prepaid + cron refund | ‚úÖ |
| 5 | UI –∑–∞–∫–∞–∑–æ–≤ (Accordion + Scroll) | ‚úÖ |
| 6 | –ù–µ–¥–æ—Å—Ç–∞—é—â–∏–µ cron jobs | ‚úÖ |
| 7 | expires_at –Ω–∞ items | ‚è≥ |
| 8 | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å —Ñ–∞–π–ª–∞–º–∏ | ‚è≥ |
| 9 | –î–µ—Ä–µ–≤–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ | ‚è≥ |
| 10 | –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ "–∏—Å—Ç–µ–∫–∞–µ—Ç" | ‚úÖ |
| 11 | –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è | ‚úÖ |
| 12 | –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å | ‚è≥ |

---

## –ó–∞–º–µ—Ç–∫–∏

- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ API –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å backward-compatible
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞
- Cron jobs —Ç—Ä–µ–±—É—é—Ç Vercel Pro –¥–ª—è —á–∞—Å—Ç–æ—Ç—ã < 1 –¥–µ–Ω—å

