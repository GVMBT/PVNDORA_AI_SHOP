# PVNDORA — Системные сообщения

## Обзор

Этот документ содержит ВСЕ системные сообщения, которые получают пользователи и админы через Telegram.

**Последнее обновление:** 2026-01-08

---

## ⚠️ СТАТУС РЕАЛИЗАЦИИ

| Уведомление | Статус | Примечание |
|-------------|--------|------------|
| Доставка заказа | ✅ Работает | Нарративный стиль с кнопкой "Мои заказы" |
| Замена аккаунта | ✅ Работает | Нарративный стиль с кнопкой |
| Реферальные уведомления | ✅ Работает | Проценты динамические, нарративный стиль |
| Кэшбек за отзыв | ✅ Работает | Нарративный стиль |
| Тикеты | ✅ Работает | Все статусы, нарративный стиль |
| Вывод средств | ✅ Работает | Все статусы, нарративный стиль |
| Пополнение баланса | ✅ Работает | Нарративный стиль |
| VIP-партнёрство | ✅ Работает | Одобрение/отклонение |
| Напоминание о подписке | ✅ ИСПРАВЛЕНО | Без скидки на продление |
| **Запрос отзыва** | 🔴 НЕ РЕАЛИЗОВАНО | Функция есть, но никогда не вызывается |

---

## Стиль оформления

Все сообщения используют единый стиль:
- **Рамка:** `◈━━━━━━━━━━━━━━━━━━━━━◈`
- **Поля:** `◈ <b>Название:</b> Значение`
- **Разделитель:** `━━━━━━━━━━━━━━━━━━━━━━━`
- **Маркеры:** `▸` для списков
- **Статусы:** `✓` для успеха, `✗` для отказа
- **Эмодзи:** Уместные по контексту (💎 💸 🔐 🔄 📈 🏆 👤 💰 ✓ ✗)

---

## 1. Уведомления о заказах

### 1.1 Успешная доставка
**Функция:** `send_delivery()`
**Кнопка:** "📦 Мои заказы" → WebApp `/orders`
```
◈━━━━━━━━━━━━━━━━━━━━━◈
      💎 ДОСТАВКА ЗАВЕРШЕНА
◈━━━━━━━━━━━━━━━━━━━━━◈

#abc12345

◈ Товар: ChatGPT Plus
◈ Статус: Активирован ✓
◈ Активен до: 08.02.2026

🔐 ДАННЫЕ ДОСТУПА
email@example.com:password123

━━━━━━━━━━━━━━━━━━━━━━━
📋 Инструкции и детали — в разделе «Мои заказы»

⭐ Оставьте отзыв → получите 5% кэшбэк
```

### 1.2 Ошибка оплаты / Возврат
```
❌ ТРАНЗАКЦИЯ ОТКЛОНЕНА. Средства возвращены на внутренний баланс.
```

---

## 2. Замена аккаунта

### 2.1 Замена выполнена
**Кнопка:** "📦 Мои заказы" → WebApp `/orders`
```
◈━━━━━━━━━━━━━━━━━━━━━◈
     🔄 ЗАМЕНА ВЫПОЛНЕНА
◈━━━━━━━━━━━━━━━━━━━━━◈

◈ Товар: ChatGPT Plus
◈ ID: abc12345

Новые данные доступа готовы.

━━━━━━━━━━━━━━━━━━━━━━━
📋 Посмотреть → «Мои заказы»
```

**Примечание:** Credentials не показываются в уведомлении из соображений безопасности.
Пользователь должен перейти в WebApp → Мои заказы.

---

## 3. Тикеты (поддержка)

### 3.1 Тикет одобрен — Замена
```
◈━━━━━━━━━━━━━━━━━━━━━◈
     ✓ ТИКЕТ ОДОБРЕН
◈━━━━━━━━━━━━━━━━━━━━━◈

#abc12345

◈ Решение: Замена
◈ Статус: В обработке

Новый аккаунт придёт в течение 24ч
```

### 3.2 Тикет одобрен — Возврат
```
◈━━━━━━━━━━━━━━━━━━━━━◈
     ✓ ТИКЕТ ОДОБРЕН
◈━━━━━━━━━━━━━━━━━━━━━◈

#abc12345

◈ Решение: Возврат средств
◈ Статус: Зачислено на баланс ✓
```

### 3.3 Тикет отклонён
**Кнопка:** "🆘 Поддержка" → WebApp `/support`
```
◈━━━━━━━━━━━━━━━━━━━━━◈
      ✗ ТИКЕТ ОТКЛОНЁН
◈━━━━━━━━━━━━━━━━━━━━━◈

#abc12345

К сожалению, запрос не может быть выполнен.

◈ Причина:
Не найдено нарушений в работе аккаунта

━━━━━━━━━━━━━━━━━━━━━━━
Есть вопросы? Напишите в поддержку.
```

---

## 4. Реферальная программа

> **Проценты динамические** — берутся из `referral_settings` в БД

### 4.1 Программа активирована
```
◈━━━━━━━━━━━━━━━━━━━━━◈
   🔗 ПАРТНЁРКА АКТИВИРОВАНА
◈━━━━━━━━━━━━━━━━━━━━━◈

Добро пожаловать в сеть PVNDORA.
Теперь вы получаете бонусы с покупок друзей.

▸ УРОВЕНЬ 1 — активен
   └ 10% с покупок рефералов

▸ УРОВЕНЬ 2 — оборот $250+
   └ +7% со 2-й линии

▸ УРОВЕНЬ 3 — оборот $1000+
   └ +3% с 3-й линии

━━━━━━━━━━━━━━━━━━━━━━━
📋 Ссылка и статистика — в профиле
```

### 4.2 Повышение до Уровня 2
```
◈━━━━━━━━━━━━━━━━━━━━━◈
    📈 УРОВЕНЬ ПОВЫШЕН
◈━━━━━━━━━━━━━━━━━━━━━◈

Вы достигли Уровня 2.
Теперь активна 2-я линия рефералов.

▸ ЛИНИЯ 1: 10%
▸ ЛИНИЯ 2: +7% ← новое

━━━━━━━━━━━━━━━━━━━━━━━
До Уровня 3: оборот $1000
```

### 4.3 Повышение до Уровня 3
```
◈━━━━━━━━━━━━━━━━━━━━━◈
    🏆 МАКСИМУМ ДОСТИГНУТ
◈━━━━━━━━━━━━━━━━━━━━━◈

Поздравляем! Уровень 3 — это вершина.
Все три линии активны.

▸ ЛИНИЯ 1: 10%
▸ ЛИНИЯ 2: 7%
▸ ЛИНИЯ 3: +3% ← новое

━━━━━━━━━━━━━━━━━━━━━━━
💎 Максимальный реферальный уровень

**Примечание:** Уровень 3 ≠ VIP-партнёр. VIP-партнёрство — отдельная сущность,
получаемая через заявку Partner Application.
```

### 4.4 Реферальный бонус
```
◈━━━━━━━━━━━━━━━━━━━━━◈
     💸 БОНУС ПОЛУЧЕН
◈━━━━━━━━━━━━━━━━━━━━━◈

Ваш реферал Ivan • линия 2
совершил покупку.

◈ Сумма покупки: $25.00
◈ Ваш бонус: +$1.75

Зачислено на баланс ✓
```

### 4.5 Новый реферал
```
◈━━━━━━━━━━━━━━━━━━━━━◈
     👤 НОВЫЙ РЕФЕРАЛ
◈━━━━━━━━━━━━━━━━━━━━━◈

Ivan
присоединился к вашей сети.

Бонусы с его покупок — автоматически ✓
```

---

## 5. Кэшбек

### 5.1 Кэшбек за отзыв
```
◈━━━━━━━━━━━━━━━━━━━━━◈
      💰 КЭШБЕК ЗАЧИСЛЕН
◈━━━━━━━━━━━━━━━━━━━━━◈

Спасибо за ваш отзыв!

◈ Начислено: +$1.25
◈ Баланс: $15.75

Ваше мнение помогает другим оперативникам ✓
```

---

## 6. Вывод средств

### 6.1 Заявка одобрена
```
◈━━━━━━━━━━━━━━━━━━━━━◈
     ✓ ВЫВОД ОДОБРЕН
◈━━━━━━━━━━━━━━━━━━━━━◈

◈ Сумма: $50.00
◈ Метод: TRC20 USDT
◈ Статус: Ожидает отправки

Средства поступят в течение 24ч
```

### 6.2 Заявка отклонена
```
◈━━━━━━━━━━━━━━━━━━━━━◈
     ✗ ВЫВОД ОТКЛОНЁН
◈━━━━━━━━━━━━━━━━━━━━━◈

◈ Сумма: $50.00

◈ Причина:
Неверный адрес кошелька

━━━━━━━━━━━━━━━━━━━━━━━
Средства возвращены на баланс ✓
```

### 6.3 Вывод выполнен
```
◈━━━━━━━━━━━━━━━━━━━━━◈
     💸 ВЫВОД ВЫПОЛНЕН
◈━━━━━━━━━━━━━━━━━━━━━◈

◈ Сумма: $50.00
◈ Метод: TRC20 USDT
◈ Статус: Отправлено ✓

Спасибо за использование PVNDORA
```

---

## 7. Пополнение баланса

### 7.1 Баланс пополнен
```
◈━━━━━━━━━━━━━━━━━━━━━◈
     💰 БАЛАНС ПОПОЛНЕН
◈━━━━━━━━━━━━━━━━━━━━━◈

◈ Зачислено: +25.00 USDT
◈ Баланс: $75.00

Средства доступны для покупок ✓
```

---

## 8. VIP Партнёрство

### 8.1 Заявка одобрена
```
◈━━━━━━━━━━━━━━━━━━━━━◈
    🏆 VIP-ПАРТНЁР PVNDORA
◈━━━━━━━━━━━━━━━━━━━━━◈

Поздравляем! Ваша заявка одобрена.

Теперь вам доступны:
▸ Повышенные комиссии
▸ Персональный менеджер
▸ Приоритетная поддержка

━━━━━━━━━━━━━━━━━━━━━━━
Добро пожаловать в команду 💎
```

### 8.2 Заявка отклонена
```
◈━━━━━━━━━━━━━━━━━━━━━◈
     ✗ ЗАЯВКА ОТКЛОНЕНА
◈━━━━━━━━━━━━━━━━━━━━━◈

◈ Причина:
Заявка не соответствует требованиям программы.

━━━━━━━━━━━━━━━━━━━━━━━
Подайте повторно позже или
напишите в поддержку.
```

---

## 9. Напоминание о подписке

### 9.1 Истекает подписка
**Cron:** `api/cron/reengagement.py` — раз в день в 12:00 UTC
**Условия:** 2-4 дня до истечения `order_items.expires_at`
```
◈━━━━━━━━━━━━━━━━━━━━━◈
     ⏰ СРОК ПОДПИСКИ
◈━━━━━━━━━━━━━━━━━━━━━◈

◈ Товар: ChatGPT Plus
◈ Статус: Истекает через 3 дн.

━━━━━━━━━━━━━━━━━━━━━━━
📋 Обновите аккаунт в каталоге
```

**Примечание:** Нет понятия "продление". Пользователь покупает новый аккаунт в каталоге.

---

## 10. Запрос отзыва

### 10.1 Запрос отзыва
**Статус:** 🔴 **НЕ РЕАЛИЗОВАНО** — функция есть, но никогда не вызывается

---

## Важные поля

| Поле | Таблица | Назначение |
|------|---------|------------|
| `orders.expires_at` | orders | Дедлайн оплаты (15 мин) |
| `order_items.expires_at` | order_items | Срок действия подписки |
| `products.duration_days` | products | Длительность подписки |

---

## Где смотреть инструкции?

**Инструкции вшиты в карточку товара в WebApp.**

При доставке пользователю направляем в раздел "Мои заказы", где он может:
1. Посмотреть credentials
2. Прочитать инструкции продукта
3. Оставить отзыв

---

## Примечания

1. Все сообщения локализуются (`interface_language` / `language_code`)
2. Поддерживаемые языки: ru, en, uk, de, fr, es, tr, ar, hi
3. HTML-разметка: `<b>`, `<code>`, `<i>` для Telegram
4. Уведомления отправляются в **Telegram-бот**, не в WebApp
5. **Проценты реферальной программы динамические** — берутся из `referral_settings`

---

## TODO

### Высокий приоритет
1. ✅ ~~Исправить напоминание о подписке~~
2. ✅ ~~Сделать проценты реферальной программы динамическими~~
3. ✅ ~~Обновить стиль сообщений (нарративный, структурированный)~~
4. 🔴 Реализовать запрос отзыва через 1-2 часа после доставки

### Средний приоритет
5. Добавить кастомные эмодзи из пака BobbyLightBlue (нужны document_id)
