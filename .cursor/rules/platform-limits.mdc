---
alwaysApply: false
---
# Vercel Platform Limits & Telegram Mini App Constraints

**Context:** PVNDORA — Telegram Mini App (TMA) on Vercel.  
**Architecture:** Hybrid Monorepo (React/Vite Frontend + Python/FastAPI Backend + Supabase + Upstash Redis).

## 1. DEPLOYMENT MODEL

| Layer | Type | Notes |
|-------|------|-------|
| Frontend | Static Site (Vite) | Served via Vercel Edge Network |
| Backend | Serverless Function | Single entry point `api/index.py` |
| Runtime | Python 3.12 | Standardized by Vercel |
| Region | Auto | Backend resolves to AWS Lambda regions |

## 2. HARD LIMITS (NON-NEGOTIABLE)

### 2.1. Compute & Bundle

| Limit | Value | Impact |
|-------|-------|--------|
| **Function Bundle Size** | 250 MB (uncompressed) | Python doesn't support tree-shaking |
| **Payload Size** | 4.5 MB (request & response) | AWS Lambda/API Gateway limitation |
| **Environment Variables** | 64 KB total | Cannot store large JSON or RSA keys |

**Mitigation:**
- Use `excludeFiles` in `vercel.json` for tests/documentation
- **NEVER** handle file uploads via API — use Presigned URLs (S3/Supabase Storage)
- Heavy libraries (Pandas, NumPy, Torch) → move to Docker platforms

### 2.2. Execution Timeouts

| Plan | Default | Maximum |
|------|---------|---------|
| **Hobby** (Legacy) | 10 sec | 10 sec |
| **Hobby** (Fluid Compute) | 60 sec | 300 sec (5 min) |
| **Pro** | 60 sec | 900 sec (15 min) |

**Rule:** Tasks >5 minutes → **must be async** via QStash/Background Workers.

## 3. NETWORK & TRAFFIC QUOTAS

| Resource | Hobby | Pro |
|----------|-------|-----|
| Fast Origin Transfer (Backend ↔ Edge) | 10 GB/month | 100 GB/month |
| Fast Data Transfer (Frontend → User) | 100 GB/month | 1 TB/month |
| Image Optimization Transforms | 1,000–5,000 (hard limit) | Pay-as-you-go |

**Warning:** Large JSON responses quickly exhaust Origin Transfer limit.

## 4. DATABASE & STATE CONSTRAINTS

### 4.1. Vercel Postgres (Neon) — DO NOT USE

| Limit | Value | Trap |
|-------|-------|------|
| Compute Time (Hobby) | 60 hours/month | DB remains "active" 5 min after request |

**Trap:** 1 request every 10 minutes → DB active 24/7 → limit exhausted in ~3 days.

**Rule:** **DO NOT use Vercel Postgres on Hobby for Production.** Use Supabase with `supabase-py` HTTP client.

### 4.2. Vercel KV (Redis)

| Plan | Limit |
|------|-------|
| **Hobby** | ~3,000 requests/day |

**Rule:** Cannot use for Rate Limiting middleware on Hobby. Use Upstash Redis.

## 5. OPERATIONAL LIMITS

| Resource | Hobby | Pro |
|----------|-------|-----|
| Logs Retention | 1 hour | 1 day (default) |
| Log Drains | ❌ | ✅ (paid bandwidth) |
| Cron Jobs | 2 (daily, ±1 hour drift) | 40 (minutely) |
| Build Concurrency | 1 slot | 12 slots |
| Build Timeout | 45 min | 45 min |
| Firewall Custom Rules | 3 | 40 |
| Firewall IP Blocks | 10 | 100 |

**When to Use Runtime Logs:**
- Debugging errors in production: `vercel logs [deployment-url] --follow`
- Post-deployment diagnostics (imports, connections)
- Monitoring critical endpoints (webhooks, workers)
- Verification after bug fixes

**See `scripts/get_latest_deployment_logs.py` for automation.**

## 6. COMMERCIAL POLICY

### Hobby Plan — STRICTLY NON-COMMERCIAL

**Prohibited:**
- Sites with advertising (AdSense)
- Affiliate links
- Payment processing (Stripe/Crypto)
- Corporate landing pages (even pre-revenue)

**Enforcement:** Automatic monitoring + manual review. Risk of **immediate blocking without notice**.

**Rule:** For PVNDORA (AI Marketplace with payments) → **Vercel Pro required from Day-1**.

## 7. TELEGRAM MINI APP SPECIFICS

### 7.1. SDK
```typescript
import { ... } from '@telegram-apps/sdk-react';
```

### 7.2. UX Hardening (Bot API 8.0+)
```typescript
// On component mount
tg.requestFullscreen();
```
```css
body { overscroll-behavior-y: none; }
```

### 7.3. Asset Safety
**Rule:** Always validate `ArrayBuffer` size when loading fonts for OG images.

## 8. AI ASSISTANT INSTRUCTIONS

When generating code **ALWAYS** check these limits:

1. ❌ **DO NOT** suggest file uploads to server — use Presigned URLs
2. ⚠️ **WARN** about Cold Start when adding Python dependencies
3. ⚠️ **WARN** about 4.5MB payload limit when working with large data
4. ✅ Assume Vercel Pro for PVNDORA (commercial project)
5. ✅ Optimize for Hobby limits where possible (cost savings)

## 9. QUICK REFERENCE TABLE

| Resource | Hobby | Pro | Action if Exceeded |
|----------|-------|-----|-------------------|
| Function Size | 250 MB | 250 MB | Deployment fails |
| Payload | 4.5 MB | 4.5 MB | 413 Error |
| Timeout | 10s/300s* | 900s | 504 Gateway Timeout |
| Origin Transfer | 10 GB/mo | 100 GB/mo | Service degrades |
| Image Transforms | 5,000 | Pay-as-you-go | 402 Error |
| Postgres Compute | 60 hrs/mo | 100 hrs/mo | DB suspends |
| Redis Requests | 3K/day | 150K/day | 429 Too Many Requests |
| Cron Jobs | 2 | 40 | Cannot schedule more |

*With Fluid Compute enabled
